(()=>{"use strict";var e,n={1485:(e,n,t)=>{var r={};t.r(r),t.d(r,{blockType:()=>vt,controlInstr:()=>$t,elem:()=>At,exportNode:()=>Dt,exportedFunc:()=>Kt,exportedGlobal:()=>Bt,exportedMemory:()=>Pt,exportedTable:()=>qt,float32:()=>ot,float32NumericInstr:()=>Ft,float64:()=>at,float64NumericInstr:()=>It,func:()=>Nt,funcSig:()=>bt,funcType:()=>gt,funcTypeRef:()=>kt,functionIndexList:()=>Ct,globalNode:()=>St,identifier:()=>dt,ifInstr:()=>xt,int32:()=>it,int32NumericInstr:()=>wt,int64:()=>st,int64NumericInstr:()=>Et,limits:()=>lt,localVar:()=>_t,memory:()=>ct,memoryInstr:()=>Lt,mod:()=>ut,mutValueType:()=>ft,paramType:()=>mt,refType:()=>ht,syntacticPlaceholder:()=>tt,tableType:()=>Mt,tableWithElemList:()=>Vt,tableWithType:()=>jt,typedef:()=>yt,uint32:()=>rt,valueType:()=>pt,variableInstr:()=>Tt});var i=t(2322),s=t(8316),o=t(5095),a=t.n(o);a().define("ace/theme/iceberg",((e,n)=>{n.isDark=!0,n.cssClass="ace-iceberg"})),a().config.setModuleUrl("ace/mode/ocaml",t(4332));var l=t(2630),c=t(2784),u=t(6954),d=t(6130),p=t(8121),f=t(6005);var m=t(1148),h=t(6349),_=t(7984),g=t(6619),y=t(8795),k=t(2335),b=t(8983);function v(e){return e<<1|1}function x(e,n){return n>>1}function $(e,n){return(0,e.exports.__float_get__)(n)}function T(e,n){return!!n}function w(e,n){return(t=(e,n)=>n,(e,n)=>{const r=e.exports.__list_tail__,i=e.exports.__list_head__,s=e=>e>0?[i(e),...s(r(e))]:[];return s(n).map((e=>t(0,e)))})(e,n);var t}const E=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function F(e,n){let t="";if(e<0)return"";do{t=E[15&e]+t,e>>=4}while(e);return t.padStart(n,"0")}function I(e){return e.slice().sort(((e,n)=>e.id-n.id)).reduce(((e,n)=>e[0]?.id===n.id?e:[n,...e]),[]).reverse()}function L(e,n){let t=0,r=0,i=[];for(;t<e.length;){const s=e[t],o=n[r];!o||s.id<o.id?(i.push(s),t++):s.id===o.id?(t++,r++):s.id>o.id&&r++}return i}function N(e){switch(e.kind){case"Int":case"Float":case"Bool":return[];case"TypeParameter":return[e];case"List":return N(e.elementType);case"Function":return[...N(e.paramType),...N(e.returnType)]}}function M(e){return I(N(e))}function j(e){return L(M(e.type),I(e.variables))}function C(e){const n=e.parent();return n?[...C(n.env),...j(n.value)]:[]}function S(e){return I(C(e))}function A(e,n){return{kind:"TypeScheme",type:e,variables:L(M(e),S(n))}}const V={Bool:0,Int:0,Float:0,TypeParameter:0,List:10,Function:20};function K(e,n,t){const r=P(n,t);return V[n.kind]<=V[e.kind]?r:`(${r})`}function P(e,n){switch(e.kind){case"Int":return"int";case"Float":return"float";case"Bool":return"bool";case"TypeParameter":return function(e){let n=[String.fromCharCode(97+e%26)];for(;e=~~(e/26);){const t=e%26;n.unshift(String.fromCodePoint(96+t))}return"'"+n.join("")}(n.idMap(e.id));case"List":return`${K(e,e.elementType,n)} list`;case"Function":return`${function(e,n,t){const r=P(n,t);return V[n.kind]<V[e.kind]?r:`(${r})`}(e,e.paramType,n)} -> ${K(e,e.returnType,n)}`}}function q(e,n=Number.MAX_SAFE_INTEGER){switch(e.kind){case"Int":case"Float":case"Bool":return n;case"TypeParameter":return e.id<n?e.id:n;case"List":return q(e.elementType,n);case"Function":return Math.min(q(e.paramType,n),q(e.returnType,n))}}function B(e){const n=(t,r)=>{const i=t.kind,s=i[0].toLowerCase()+i.slice(1),o=e[s];if("function"!=typeof o)throw new Error("invalid kind");return o(t,r,n)};return n}function D(e){return"object"==typeof e&&"string"==typeof e.kind}function O(e){return{forEachChild:(n,t)=>{for(const r of e){const e=n[r];e&&(Array.isArray(e)?e.forEach((e=>{D(e)&&t(e)})):D(e)&&t(e))}},visitEachChild:(n,t)=>{const r={...n};for(const i of e){const e=n[i];if(e)if(Array.isArray(e)){const n=e.reduce(((e,n)=>{if(!D(n))return[...e,n];const r=t(n);return null===r?e:r?Array.isArray(r)?[...e,...r]:[...e,r]:[...e,n]}),[]);r[i]=n}else if(D(e)){const n=t(e);n&&(r[i]=n)}}return r}}}function W(e){if(!e.ok)throw new Error(e.value.message);return e.value}function U(...e){return n=>{const t=[];for(const n of e){if(!n.ok)return n;t.push(n.value)}return n(...t)}}function z(e){const n=[];for(const t of e){if(!t.ok)return t;n.push(t.value)}return R(n)}function R(e){const n={ok:!0,value:e,unwrap:()=>W(n),map:n=>R(n(e)),tap:n=>(n(e),R(e)),error:()=>n,mapValue:n=>n(e)};return n}function G(e){const n={ok:!1,value:e,unwrap:()=>W(n),map:()=>n,tap:()=>n,error:n=>G(n(e)),mapValue:()=>n};return n}function H(){return{mapValue:U,ok:e=>R(e),error:e=>G(e)}}const Z=(...e)=>n=>{const t=n.pos;let r=G({confirmed:!1,message:"",occurence:{loc:{pos:t,end:t+1}}});for(const t of e.slice().reverse()){if(r=t(n),!r.ok&&r.value.confirmed)return r;if(r.ok)return r}return G({message:"Unexpected expression.",confirmed:!1,occurence:{loc:{pos:t,end:n.pos===t?t+1:n.pos}}})},X=e=>n=>e()(n),Q=(...e)=>n=>t=>{const r=[];let i=0;for(const n of e){const e=n(t);if(!e.ok)return G({...e.value,confirmed:0!==i});r.push(e.value),i++}return R(n(...r,t))};let Y=0;function J(){return F(++Y,6)}function ee(...e){if(0===e.length)return{_nodeId:J()};const[n,...t]=e;if(!t.length)return{loc:n.loc,_nodeId:J()};const r=t[t.length-1];return{loc:{pos:n.loc?.pos,end:r.loc?.end},_nodeId:J()}}const ne=e=>(...n)=>t=>r=>{const i=e(r);if(!i.ok)return i;const s=e=>{const i=[];let o=0;for(const t of n){const n=t(r);if(!n.ok)return 0===o?R(e):G({...n.value,message:"Missing operand.",confirmed:!1});i.push(n.value),o++}return s(t(e,...i))};return s(i.value)},te=e=>(...n)=>t=>r=>{const i=e(r);if(!i.ok)return i;const s=e=>{const i=[];let o=0;for(const t of n){const n=t(r);if(!n.ok)return 0===o?R(e):G({...n.value,message:"Missing operand.",confirmed:!1});i.push(n.value),o++}const a=i.slice(0,i.length-1),l=i[i.length-1];return R(t(e,...a,s(l).value))};return s(i.value)};class re{input;_pos=0;constructor(e){this.input=e}_head(e=0){const n=this._leadingTrivia();return this.input.substr(this._pos+n+e)}_leadingTrivia(){let e=0;for(;;){const n=this.leadingWhitespace(this._pos+e),t=this.leadingComment(this._pos+e+n);if(0===n&&0===t)break;e+=n+t}return e}hasNext(e=0){return this.pos+this._leadingTrivia()+e<this.input.length}slice(e){return this._head().slice(0,e)}startsWith(e,n=0){return this._head(n).startsWith(e)}match(e,n=0){return this._head(n).match(e)}leadingWhitespace(e){let n=0;for(;;n++){const t=this.input[e+n];if(" "!==t&&"\t"!==t&&"\r"!==t&&"\n"!==t)break}return n}leadingComment(e){return 0}consume(e){const n=this._leadingTrivia(),t={pos:this._pos+n,end:this._pos+n+e};return this._pos+=n+e,t}get pos(){return this._pos}back(e){return this._pos=e,e}}class ie extends re{leadingComment(e){if(!this.input.slice(e).startsWith("(*"))return 0;let n=1,t=2;for(;n>0&&e+t<this.input.length;)"*)"===this.input.substr(e+t,2)?(t+=2,n--):"(*"===this.input.substr(e+t,2)?(t+=2,n++):++t;return t}}const se=["if","then","else","let","in","fun","rec","true","false","match","with"],oe=e=>n=>n.startsWith(e)?R({tokenKind:"Symbol",symbol:e,loc:n.consume(e.length)}):G({confirmed:!1,message:`'${e}' expected.`,occurence:{loc:{pos:n.pos,end:n.pos+1}}}),ae=e=>n=>n.startsWith(e)&&n.match(/^($|[^a-zA-Z0-9\$_])/,e.length)?R({tokenKind:"Keyword",keyword:e,loc:n.consume(e.length)}):G({confirmed:!1,message:`'${e}' expected.`,occurence:{loc:{pos:n.pos,end:n.pos+1}}}),le=e=>n=>{const t=[];for(;;){const r=e(n);if(!r.ok)break;t.push(r.value)}return R({values:t,loc:t.length?ee(...t).loc:{pos:n.pos,end:n.pos}})},ce=Z(X((()=>ye)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))),ue=Q(ae("let"),Z(Q(X((()=>je)),le(X((()=>je))),oe("="),X((()=>ce)),ae("in"),X((()=>ce)))(((e,n,t,r,i,s)=>({kind:"LetExpression",identifier:e,binding:n.values.slice().reverse().reduce(((e,n)=>({kind:"FunctionDefinition",param:n,body:e,...ee(r)})),r),exp:s,...ee(e,n,t,r,i,s)}))),Q(ae("rec"),X((()=>je)),Z(Q(oe("="),X((()=>de)))(((e,n)=>n)),Q(X((()=>je)),le(X((()=>je))),oe("="),X((()=>ce)))(((e,n,t,r)=>({kind:"FunctionDefinition",param:e,body:n.values.slice().reverse().reduce(((e,n)=>({kind:"FunctionDefinition",param:n,body:e,...ee(r)})),r),...ee(e,n,t,r)})))),ae("in"),X((()=>ce)))(((e,n,t,r,i)=>({kind:"LetRecExpression",identifier:n,binding:t,exp:i,...ee(e,n,t,r,i)})))))(((e,n)=>({...n,...ee(e,n)}))),de=Q(ae("fun"),X((()=>je)),oe("->"),X((()=>ce)))(((e,n,t,r)=>({kind:"FunctionDefinition",param:n,body:r,...ee(e,n,t,r)}))),pe=Q(ae("if"),X((()=>ce)),ae("then"),X((()=>ce)),ae("else"),X((()=>ce)))(((e,n,t,r,i,s)=>({kind:"IfExpression",cond:n,then:r,else:s,...ee(e,n,t,r,i,s)}))),fe=Q(ae("match"),X((()=>ce)),ae("with"),X((()=>me)))(((e,n,t,r)=>({kind:"MatchExpression",exp:n,matchClause:r,...ee(e,n,t,r)}))),me=te(X((()=>he)))(oe("|"),X((()=>he)))(((e,n,t)=>({kind:"MatchOrClause",patternMatch:e,or:t,...ee(e,n,t)}))),he=Q(X((()=>_e)),oe("->"),X((()=>ce)))(((e,n,t)=>({kind:"PatternMatchClause",pattern:e,exp:t,...ee(e,n,t)}))),_e=te(X((()=>ge)))(oe("::"),X((()=>ge)))(((e,n,t)=>({kind:"ListConsPattern",head:e,tail:t,...ee(e,n,t)}))),ge=Z(Q(X((()=>je)))((e=>({kind:"IdPattern",identifier:e,...ee(e)}))),Q(oe("["),oe("]"))(((e,n)=>({kind:"EmptyListPattern",...ee(e,n)}))),Q(oe("_"))((e=>({kind:"WildcardPattern",...ee(e)})))),ye=te(X((()=>ke)))(oe("||"),Z(X((()=>ke)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"BinaryExpression",op:{kind:"Or",token:n},left:e,right:t,...ee(e,n,t)}))),ke=te(X((()=>be)))(oe("&&"),Z(X((()=>be)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"BinaryExpression",op:{kind:"And",token:n},left:e,right:t,...ee(e,n,t)}))),be=ne(X((()=>ve)))(Z(oe("<"),oe(">"),oe("<="),oe(">="),oe("="),oe("<>"),oe("=="),oe("!=")),Z(X((()=>ve)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"BinaryExpression",op:{kind:"<"===n.symbol?"LessThan":">"===n.symbol?"GreaterThan":"<="===n.symbol?"LessEqualThan":">="===n.symbol?"GreaterEqualThan":"="===n.symbol?"Equal":"<>"===n.symbol?"NotEqual":"=="===n.symbol?"PEqual":"!="===n.symbol?"PNotEqual":void 0,token:n},left:e,right:t,...ee(e,n,t)}))),ve=te(X((()=>xe)))(oe("::"),Z(X((()=>xe)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"ListConstructor",head:e,tail:t,...ee(e,n,t)}))),xe=ne(X((()=>$e)))(Z(oe("+"),oe("-"),oe("+."),oe("-.")),Z(X((()=>$e)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"BinaryExpression",op:"+"===n.symbol?{kind:"Add",token:n}:"+."===n.symbol?{kind:"FAdd",token:n}:"-"===n.symbol?{kind:"Sub",token:n}:"-."===n.symbol?{kind:"FSub",token:n}:null,left:e,right:t,...ee(e,n,t)}))),$e=ne(X((()=>Te)))(Z(oe("*"),oe("*."),oe("/"),oe("/.")),Z(X((()=>Te)),X((()=>pe)),X((()=>fe)),X((()=>de)),X((()=>ue))))(((e,n,t)=>({kind:"BinaryExpression",op:{kind:"*"===n.symbol?"Multiply":"*."===n.symbol?"FMultiply":"/"===n.symbol?"Div":"/."===n.symbol?"FDiv":null,token:n},left:e,right:t,...ee(e,n,t)}))),Te=Z(X((()=>we)),Q(Z(oe("-"),oe("-.")),X((()=>we)))(((e,n)=>({kind:"UnaryExpression",op:"-"===e.symbol?{kind:"Minus",token:e}:{kind:"FMinus",token:e},exp:n,...ee(e,n)})))),we=ne(X((()=>Ee)))(X((()=>Ee)))(((e,n)=>({kind:"FunctionApplication",callee:e,argument:n,...ee(e,n)}))),Ee=Z(X((()=>je)),X((()=>Me)),X((()=>Ne)),X((()=>Le)),X((()=>Ie)),X((()=>Fe))),Fe=Q(oe("("),X((()=>ce)),oe(")"))(((e,n,t)=>({...n,...ee(e,n,t)}))),Ie=Q(oe("["),oe("]"))(((e,n)=>({kind:"EmptyList",...ee(e,n)}))),Le=Z(Q(ae("true"))((e=>({kind:"BoolLiteral",value:!0,...ee(e)}))),Q(ae("false"))((e=>({kind:"BoolLiteral",value:!1,...ee(e)})))),Ne=Q((e=>{const n=e.match(/^(\d+\.\d*)/);return n?R({tokenKind:"Decimal",value:parseFloat(n[1]),loc:e.consume(n[1].length)}):G({confirmed:!1,message:"Floating number expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}})}))((e=>({kind:"FloatLiteral",value:e.value,...ee(e)}))),Me=Q((e=>{const n=e.match(/^(\d+)/);return n?R({tokenKind:"Integer",value:parseInt(n[1],10),loc:e.consume(n[1].length)}):G({confirmed:!1,message:"Integer expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}})}))((e=>({kind:"IntLiteral",value:e.value,...ee(e)}))),je=Q((e=>{const n=e.match(/^([a-zA-Z_][a-zA-Z0-9_']*)/);if(!n)return G({confirmed:!1,message:"Identifier expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}});const t=se.find((e=>e===n[1]));return t?G({confirmed:!0,message:`'${t}' is not allowed as an identifier name.`,occurence:{loc:{pos:e.pos,end:e.pos+t.length}}}):R({tokenKind:"Variable",name:n[1],loc:e.consume(n[1].length)})}))((e=>({kind:"Identifier",name:e.name,...ee(e)})));function Ce(e){return ce(new ie(e))}function Se(e,n){let t=0,r=0;for(let i=0;i<e.length;i++){const s=e[i];if(t===n.line&&r===n.character)return i;"\n"===s?(r=0,t++):r++}return e.length}class Ae{idx=0;gen(e){return{kind:"TypeParameter",id:this.idx++,referencedFrom:e}}}function Ve(){const e={kind:"TypeEnvironment",get(){},parent(){},map:()=>e};return e}function Ke(e,n,t){const r={kind:"TypeEnvironment",get:r=>e.name===r.name?n:t.get(r),parent:()=>({value:n,env:t}),map(t){const{env:i}=r.parent(),s=i.map(t),o=t(n);return Ke(e,o,s)}};return r}const{ok:Pe,error:qe}=H(),Be={ok:(e,n=[])=>Pe({expressionType:e,substitutions:n}),error:qe},De=e=>Be.ok({kind:"Int",referencedFrom:e}),Oe=e=>Be.ok({kind:"Float",referencedFrom:e}),We=e=>Be.ok({kind:"Bool",referencedFrom:e}),Ue=(e,n)=>Be.ok({kind:"List",elementType:n.generator.gen(e),referencedFrom:e});function ze(e,...n){return n.reduce(((e,n)=>function(e,n){switch(e.kind){case"Int":case"Float":case"Bool":return e;case"TypeParameter":return e.id===n.from.id?{...n.to,referencedFrom:e.referencedFrom}:e;case"Function":return{kind:"Function",paramType:ze(e.paramType,n),returnType:ze(e.returnType,n),referencedFrom:e.referencedFrom};case"List":return{kind:"List",elementType:ze(e.elementType,n),referencedFrom:e.referencedFrom}}}(e,n)),e)}function Re(e,...n){return e.map((e=>function(e,...n){return n.reduce(((n,t)=>n.variables.some((e=>e.id===t.from.id))?e:{...e,type:ze(e.type,t)}),e)}(e,...n)))}function Ge(...e){return e.reduce(((e,{substitutions:n})=>[...e,...n.map((({from:e,to:n})=>({lhs:e,rhs:n})))]),[])}const He=(e,n)=>{const t=n.env.get(e);if(!t)return Be.error({message:`No identifier ${e.name}`,occurence:e});const r=t.variables.map((t=>({from:t,to:n.generator.gen(e)})));return Be.ok({...ze(t.type,...r),referencedFrom:e})};function Ze(e,n){switch(e.kind){case"Int":case"Float":case"Bool":return e.kind===n.kind;case"Function":return"Function"===n.kind&&Ze(e.paramType,n.paramType)&&Ze(e.returnType,n.returnType);case"List":return"List"===n.kind&&Ze(e.elementType,n.elementType);case"TypeParameter":return"TypeParameter"===n.kind&&e.id===n.id}}function Xe(e){return{kind:"TypeScheme",type:e,variables:[]}}function Qe(e,n,t,r,i=[],s=[]){if("WildcardPattern"===e.kind)return R({typeEnv:t,equations:s});if("EmptyListPattern"===e.kind){const i=r.gen(e);return R({typeEnv:t,equations:[...s,{lhs:n,rhs:{kind:"List",elementType:i,referencedFrom:e}}]})}if("IdPattern"===e.kind)return i.some((n=>n===e.identifier.name))?G({message:`Duplicated identifier, '${e.identifier.name}'.`,occurence:e.identifier}):R({typeEnv:Ke(e.identifier,Xe(n),t),equations:s});if("ListConsPattern"===e.kind){if("IdPattern"===e.head.kind){const o=e.head.identifier.name;if(i.some((e=>e===o)))return G({message:`Duplicated identifier, '${o}'.`,occurence:e.head.identifier});const a=r.gen(e.head);return Qe(e.tail,n,Ke(e.head.identifier,Xe(a),t),r,[...i,o],[...s,{lhs:n,rhs:{kind:"List",elementType:a,referencedFrom:e}}])}return Qe(e.tail,n,t,r,i,s)}throw new Error(`invalid node kind: ${e.kind}`)}const{ok:Ye,error:Je}=H();function en(e){if(0===e.length)return Ye([]);const[n,...t]=e;if(Ze(n.lhs,n.rhs))return en(t);if("Function"===n.lhs.kind&&"Function"===n.rhs.kind)return en([...t,{lhs:n.lhs.paramType,rhs:n.rhs.paramType},{lhs:n.lhs.returnType,rhs:n.rhs.returnType}]);if("List"===n.lhs.kind&&"List"===n.rhs.kind)return en([...t,{lhs:n.lhs.elementType,rhs:n.rhs.elementType}]);let r,i;if("TypeParameter"===n.lhs.kind&&(r=n.lhs,i=n.rhs),"TypeParameter"===n.rhs.kind&&(r=n.rhs,i=n.lhs),null!=r&&null!=i){if(function(e){switch(e.kind){case"TypeScheme":return j(e);case"TypeEnvironment":return S(e);default:return M(e)}}(i).some((e=>e.id===r?.id)))return Je({message:"This equation does not have solution.",occurence:r.referencedFrom});const n={from:r,to:i};return en(function(e,n){return e.map((e=>({lhs:ze(e.lhs,n),rhs:ze(e.rhs,n)})))}(e,n)).map((e=>function(e,n){return[{from:n.from,to:e.reduce(((e,n)=>ze(e,n)),n.to)},...e]}(e,n)))}return Je({message:"This equation does not have solution.",occurence:n.lhs.referencedFrom,messageWithTypes:e=>`This expression type is "${e(n.lhs)}" but the expected type is "${e(n.rhs)}".`})}const nn=(e,n,t)=>U(t(e.head,n),t(e.tail,n))(((n,t)=>en([...Ge(n,t),{lhs:t.expressionType,rhs:{kind:"List",elementType:n.expressionType,referencedFrom:e}}]).mapValue((e=>Be.ok(ze(t.expressionType,...e),e))))),tn=(e,n,t)=>{switch(e.op.kind){case"Minus":return t(e.exp,n).mapValue((n=>en([...Ge(n),{lhs:n.expressionType,rhs:{kind:"Int",referencedFrom:e}}]).mapValue((n=>Be.ok({kind:"Int",referencedFrom:e},n)))));case"FMinus":return t(e.exp,n).mapValue((n=>en([...Ge(n),{lhs:n.expressionType,rhs:{kind:"Float",referencedFrom:e}}]).mapValue((n=>Be.ok({kind:"Float",referencedFrom:e},n)))));default:throw new Error(`invalid operation ${e.op.kind}`)}},rn={Add:"Int",FAdd:"Float",Sub:"Int",FSub:"Float",Multiply:"Int",FMultiply:"Float",Div:"Int",FDiv:"Float",Or:"Bool",And:"Bool",LessThan:"Bool",LessEqualThan:"Bool",GreaterThan:"Bool",GreaterEqualThan:"Bool",Equal:"Bool",NotEqual:"Bool",PEqual:"Bool",PNotEqual:"Bool"},sn={Add:"Int",FAdd:"Float",Sub:"Int",FSub:"Float",Multiply:"Int",FMultiply:"Float",Div:"Int",FDiv:"Float",Or:"Bool",And:"Bool"};function on(e,n,t){return"LessThan"===e.op.kind||"LessEqualThan"===e.op.kind||"GreaterThan"===e.op.kind||"GreaterEqualThan"===e.op.kind||"Equal"===e.op.kind||"NotEqual"===e.op.kind||"PEqual"===e.op.kind||"PNotEqual"===e.op.kind?[{lhs:n.expressionType,rhs:t.expressionType}]:[{lhs:n.expressionType,rhs:{kind:sn[e.op.kind],referencedFrom:e.left}},{lhs:t.expressionType,rhs:{kind:sn[e.op.kind],referencedFrom:e.right}}]}const an=(e,n,t)=>U(t(e.left,n),t(e.right,n))(((n,t)=>en([...Ge(n,t),...on(e,n,t)]).mapValue((n=>Be.ok({kind:rn[e.op.kind],referencedFrom:e},n))))),ln=(e,n,t)=>{const r=n.generator.gen(e.param),i=Ke(e.param,Xe(r),n.env);return t(e.body,{...n,env:i}).mapValue((n=>Be.ok(ze({kind:"Function",paramType:r,returnType:n.expressionType,referencedFrom:e},...n.substitutions),n.substitutions)))},cn=(e,n,t)=>U(t(e.cond,n),t(e.then,n),t(e.else,n))(((n,t,r)=>en([...Ge(n,t,r),{lhs:n.expressionType,rhs:{kind:"Bool",referencedFrom:e.cond}},{lhs:t.expressionType,rhs:r.expressionType}]).mapValue((e=>Be.ok(ze(t.expressionType,...e),e))))),un=(e,n,t)=>t(e.exp,n).mapValue((r=>{const i=function(e){const n=(e,t=[])=>"PatternMatchClause"===e.kind?[...t,e]:n(e.or,[...t,e.patternMatch]);return n(e.matchClause)}(e);return U(...i.map((({pattern:e,exp:i})=>Qe(e,r.expressionType,n.env,n.generator).mapValue((({typeEnv:e,equations:r})=>t(i,{...n,env:e}).map((e=>({patternType:e,equations:r}))))))))(((...e)=>{const n=e.map((e=>e.patternType)),t=e.flatMap((e=>e.equations));if(0===n.length)throw new Error("unreachable");const[i,...s]=n,o=s.map((e=>({lhs:i.expressionType,rhs:e.expressionType})));return en([...Ge(r,...n),...t,...o]).mapValue((e=>Be.ok(ze(i.expressionType,...e),e)))}))})),dn=(e,n,t)=>U(t(e.binding,n))((r=>{const i=A(r.expressionType,Re(n.env,...r.substitutions)),s=Ke(e.identifier,i,n.env);return t(e.exp,{...n,env:s}).mapValue((e=>en(Ge(r,e)).mapValue((n=>Be.ok(ze(e.expressionType,...n),n)))))})),pn=(e,n,t)=>{const r=n.generator.gen(e.binding),i=n.generator.gen(e.binding.param),s=Ke(e.binding.param,Xe(i),Ke(e.identifier,Xe(r),n.env));return t(e.binding.body,{...n,env:s}).mapValue((s=>en([...Ge(s),{lhs:r,rhs:{kind:"Function",paramType:i,returnType:s.expressionType,referencedFrom:e.binding}}]).mapValue((i=>{const s=A(ze(r,...i),Re(n.env,...i)),o=Ke(e.identifier,s,n.env);return U(t(e.exp,{...n,env:o}))((e=>en(Ge({substitutions:i},e)).mapValue((n=>Be.ok(ze(e.expressionType,...n),n)))))}))))},fn=(e,n,t)=>U(t(e.callee,n),t(e.argument,n))(((t,r)=>{const i=n.generator.gen(e);return en([...Ge(t,r),{lhs:{kind:"Function",paramType:r.expressionType,returnType:i,referencedFrom:e.callee},rhs:t.expressionType}]).mapValue((e=>Be.ok(ze(i,...e),e)))}));function mn(e){const n=new Map;return B(function(e){const n=Object.keys(e),t={};for(const r of n){const n=e[r],i=(e,t,r)=>{const i=n(e,t,r);return i.ok&&e._nodeId&&t.ptMap?.set(e._nodeId,i.value.expressionType),i};t[r]=i}return t}({intLiteral:De,floatLiteral:Oe,boolLiteral:We,emptyList:Ue,identifier:He,listConstructor:nn,unaryExpression:tn,binaryExpression:an,functionDefinition:ln,ifExpression:cn,matchExpression:un,letExpression:dn,letRecExpression:pn,functionApplication:fn}))(e,{generator:new Ae,env:Ve(),ptMap:n}).map((e=>({rootPrimaryType:e,typeValueMap:n})))}function hn(e,n){e.forEach(((e,t)=>{e.id&&n.set(e.id.value,t)}))}function _n(e,n){if("Uint32Literal"===n.kind)return R(n.value);const t=e.get(n.value);return null==t?G({message:`Not found "${n.value}"`}):R(t)}function gn(e){switch(e.valueKind){case"i32":return{kind:"Int32Type"};case"i64":return{kind:"Int64Type"};case"f32":return{kind:"Float32Type"};case"f64":return{kind:"Float64Type"};default:throw new Error(`Invalid value kind: ${e.valueKind}`)}}function yn(e){return e.map((e=>gn(e.valueType)))}const kn={block:{code:2},loop:{code:3},if:{code:4},else:{code:5},end:{code:11}},bn={unreachable:{code:0,args:[]},nop:{code:1,args:[]},br:{code:12,args:["labels"]},br_if:{code:13,args:["labels"]},return:{code:15,args:[]},call:{code:16,args:["funcs"]},call_indirect:{code:17,args:["tables","types"]}},vn={"local.get":{code:32,args:["locals"]},"local.set":{code:33,args:["locals"]},"local.tee":{code:34,args:["locals"]},"global.get":{code:35,args:["globals"]},"global.set":{code:36,args:["globals"]}},xn={"i32.const":{code:65,args:["SignedInteger"]},"i32.eqz":{code:69,args:[]},"i32.eq":{code:70,args:[]},"i32.ne":{code:71,args:[]},"i32.lt_s":{code:72,args:[]},"i32.lt_u":{code:73,args:[]},"i32.gt_s":{code:74,args:[]},"i32.gt_u":{code:75,args:[]},"i32.le_s":{code:76,args:[]},"i32.le_u":{code:77,args:[]},"i32.ge_s":{code:78,args:[]},"i32.ge_u":{code:79,args:[]},"i32.clz":{code:103,args:[]},"i32.ctz":{code:104,args:[]},"i32.popcnt":{code:105,args:[]},"i32.add":{code:106,args:[]},"i32.sub":{code:107,args:[]},"i32.mul":{code:108,args:[]},"i32.div_s":{code:109,args:[]},"i32.div_u":{code:110,args:[]},"i32.rem_s":{code:111,args:[]},"i32.rem_u":{code:112,args:[]},"i32.and":{code:113,args:[]},"i32.or":{code:114,args:[]},"i32.xor":{code:115,args:[]},"i32.shl":{code:116,args:[]},"i32.shr_s":{code:117,args:[]},"i32.shr_u":{code:118,args:[]},"i32.rotl":{code:119,args:[]},"i32.rotr":{code:120,args:[]}},$n={"i64.const":{code:66,args:["DoubleSignedInteger"]},"i64.eqz":{code:80,args:[]},"i64.eq":{code:81,args:[]},"i64.ne":{code:82,args:[]},"i64.lt_s":{code:83,args:[]},"i64.lt_u":{code:84,args:[]},"i64.gt_s":{code:85,args:[]},"i64.gt_u":{code:86,args:[]},"i64.le_s":{code:87,args:[]},"i64.le_u":{code:88,args:[]},"i64.ge_s":{code:89,args:[]},"i64.ge_u":{code:90,args:[]},"i64.clz":{code:121,args:[]},"i64.ctz":{code:122,args:[]},"i64.popcnt":{code:123,args:[]},"i64.add":{code:124,args:[]},"i64.sub":{code:125,args:[]},"i64.mul":{code:126,args:[]},"i64.div_s":{code:127,args:[]},"i64.div_u":{code:128,args:[]},"i64.rem_s":{code:129,args:[]},"i64.rem_u":{code:130,args:[]},"i64.and":{code:131,args:[]},"i64.or":{code:132,args:[]},"i64.xor":{code:133,args:[]},"i64.shl":{code:134,args:[]},"i64.shr_s":{code:135,args:[]},"i64.shr_u":{code:136,args:[]},"i64.rotl":{code:137,args:[]},"i64.rotr":{code:138,args:[]}},Tn={"f32.const":{code:67,args:["SignedFloat"]},"f32.eq":{code:91,args:[]},"f32.ne":{code:92,args:[]},"f32.lt":{code:93,args:[]},"f32.gt":{code:94,args:[]},"f32.le":{code:95,args:[]},"f32.ge":{code:96,args:[]},"f32.abs":{code:139,args:[]},"f32.neg":{code:140,args:[]},"f32.ceil":{code:142,args:[]},"f32.floor":{code:141,args:[]},"f32.trunc":{code:143,args:[]},"f32.nearest":{code:144,args:[]},"f32.sqrt":{code:145,args:[]},"f32.add":{code:146,args:[]},"f32.sub":{code:147,args:[]},"f32.mul":{code:148,args:[]},"f32.div":{code:149,args:[]},"f32.min":{code:150,args:[]},"f32.max":{code:151,args:[]},"f32.copysign":{code:152,args:[]}},wn={"f64.const":{code:68,args:["DoubleSignedFloat"]},"f64.eq":{code:97,args:[]},"f64.ne":{code:98,args:[]},"f64.lt":{code:99,args:[]},"f64.gt":{code:100,args:[]},"f64.le":{code:101,args:[]},"f64.ge":{code:102,args:[]},"f64.abs":{code:153,args:[]},"f64.neg":{code:154,args:[]},"f64.ceil":{code:155,args:[]},"f64.floor":{code:156,args:[]},"f64.trunc":{code:157,args:[]},"f64.nearest":{code:158,args:[]},"f64.sqrt":{code:159,args:[]},"f64.add":{code:160,args:[]},"f64.sub":{code:161,args:[]},"f64.mul":{code:162,args:[]},"f64.div":{code:163,args:[]},"f64.min":{code:164,args:[]},"f64.max":{code:165,args:[]},"f64.copysign":{code:166,args:[]}},En={"i32.load":{code:40,defaultAlign:2},"i64.load":{code:41,defaultAlign:3},"f32.load":{code:42,defaultAlign:2},"f64.load":{code:43,defaultAlign:3},"i32.load8_s":{code:44,defaultAlign:0},"i32.load8_u":{code:45,defaultAlign:0},"i32.load16_s":{code:46,defaultAlign:0},"i32.load16_u":{code:47,defaultAlign:0},"i64.load8_s":{code:48,defaultAlign:0},"i64.load8_u":{code:49,defaultAlign:0},"i64.load16_s":{code:50,defaultAlign:0},"i64.load16_u":{code:51,defaultAlign:0},"i64.load32_s":{code:52,defaultAlign:0},"i64.load32_u":{code:53,defaultAlign:0},"i32.store":{code:54,defaultAlign:2},"i64.store":{code:55,defaultAlign:3},"f32.store":{code:56,defaultAlign:2},"f64.store":{code:57,defaultAlign:3},"i32.store8":{code:58,defaultAlign:0},"i32.store16":{code:59,defaultAlign:0},"i64.store8":{code:60,defaultAlign:0},"i64.store16":{code:61,defaultAlign:0},"i64.store64":{code:62,defaultAlign:0}},Fn={...xn,...$n,...Tn,...wn};function In(e){return R(e?.value??null)}function Ln(e,n){return{kind:"FuncType",paramType:e,resultType:n}}function Nn(e,n){if(e.kind!==n.kind)return!1;if(e.paramType.length!==n.paramType.length)return!1;if(e.resultType.length!==n.resultType.length)return!1;for(let t=0;t<e.paramType.length;t++)if(e.paramType[t].kind!==n.paramType[t].kind)return!1;for(let t=0;t<e.resultType.length;t++)if(e.resultType[t].kind!==n.resultType[t].kind)return!1;return!0}const Mn=e=>{const{args:n}=Fn[e.instructionKind];return z(e.parameters.map(((t,r)=>n[r]?R(t.value):G({message:`${e.instructionKind} can not have ${r}th param`})))).map((n=>({kind:"NumericInstruction",instructionKind:e.instructionKind,parameters:n})))},jn=B({ifInstruction:(e,n,t)=>{let r=null;if(e.blockType.type||0!==e.blockType.results.length)if(e.blockType.type||1!==e.blockType.results.length)if(e.blockType.type){const t=_n(n.refCtx.types,e.blockType.type);if(!t.ok)return G(t.value);r=t.value}else{const t=Ln([],e.blockType.results.map(gn)),i=n.types.findIndex((e=>Nn(e,t)));-1===i?(r=n.types.length,n.types.push(t)):r=i}else r=gn(e.blockType.results[0]);else r=null;return U(z(e.thenExpr.map((e=>t(e,n)))),z(e.elseExpr.map((e=>t(e,n)))))(((e,n)=>R({kind:"IfInstruction",blockType:r,thenExpr:e,elseExpr:n})))},controlInstruction:(e,{refCtx:n})=>{const{args:t}=bn[e.instructionKind];return z(e.parameters.map(((r,i)=>t[i]?_n(n[t[i]],"FuncTypeRef"===r.kind?r.type:r):G({message:`${e.instructionKind} can not have ${i}th param`})))).map((n=>({kind:"ControlInstruction",instructionKind:e.instructionKind,parameters:n})))},variableInstruction:(e,{refCtx:n})=>{const{args:t}=vn[e.instructionKind];return z(e.parameters.map(((r,i)=>t[i]?_n(n[t[i]],r):G({message:`${e.instructionKind} can not have ${i}th param`})))).map((n=>({kind:"VariableInstruction",instructionKind:e.instructionKind,parameters:n})))},memoryInstruction:e=>{const{defaultAlign:n}=En[e.instructionKind];return U(In(e.offset),In(e.align))(((t,r)=>R({kind:"MemoryInstruction",instructionKind:e.instructionKind,offset:t??0,align:r??n})))},int32NumericInstruction:Mn,int64NumericInstruction:Mn,float32NumericInstruction:Mn,float64NumericInstruction:Mn});function Cn(e){return U(function(e){return R(e.value)}(e.min),In(e.max))(((e,n)=>R({kind:"Limits",min:e,max:n})))}function Sn(e,{refCtx:n,offsetExpr:t}){return t?U(z(e.indices.map((e=>_n(n.funcs,e)))),z(t.map((e=>jn(e,{refCtx:n,types:[]})))))(((e,n)=>R({kind:"FunctionIndexList",indices:e,offsetExpr:n}))):z(e.indices.map((e=>_n(n.funcs,e)))).map((e=>({kind:"FunctionIndexList",indices:e,offsetExpr:[{kind:"NumericInstruction",instructionKind:"i32.const",parameters:[0]}]})))}function An(e){const n=e=>[...e.entries()].map((([e,n])=>({kind:"NameAssociation",idx:n,name:e})));return{kind:"Names",funcs:n(e.funcs),locals:[...e.funcLocals.entries()].map((([e,t])=>({kind:"IndirectNameMap",idx:e,nameMap:n(t)}))),types:n(e.types),tables:n(e.tables),mems:n(e.mems),globals:n(e.globals)}}function Vn(e){if(e<0)throw new Error("Value must not be negative.");const n=[];for(;;){const t=127&e;if(0==(e>>=7)){n.push(t);break}n.push(128|t)}return new Uint8Array(n)}function Kn(e){e|=0;const n=[];for(;;){const t=127&e;if(0==(e>>=7)&&0==(64&t)||-1===e&&0!=(64&t)){n.push(t);break}n.push(128|t)}return new Uint8Array(n)}const Pn=new Uint8Array([0,97,115,109]),qn=new Uint8Array([1,0,0,0]),Bn={Func:0,Table:1,Memory:2,Global:3};function Dn(e){return new Uint8Array([e])}function On(e){return Vn(e)}function Wn(e){return Kn(e)}function Un(...e){const n=e.reduce(((e,n)=>e+n.byteLength),0),t=new Uint8Array(n);let r=0;for(const n of e)t.set(n,r),r+=n.byteLength;return t}function zn(e){const n=function(e){return(new TextEncoder).encode(e)}(e);return Un(On(n.byteLength),n)}function Rn(e){return Un(On(e.length),...e)}function Gn(e,n){if(!n.length)return new Uint8Array;const t=Rn(n);return Un(Dn(e),Vn(t.byteLength),t)}function Hn(e){return e.map((({idx:e,name:n})=>Un(On(e),zn(n))))}function Zn(e){switch(e.kind){case"Int32Type":return Dn(127);case"Int64Type":return Dn(126);case"Float32Type":return Dn(125);case"Float64Type":return Dn(124);default:throw new Error(`Invalid value type kind: ${e.kind}`)}}function Xn(e){return Un(Dn(96),Rn(e.paramType.map(Zn)),Rn(e.resultType.map(Zn)))}function Qn({min:e,max:n}){return n?Un(Dn(1),On(e),On(n)):Un(Dn(0),On(e))}function Yn(e){return e.map((e=>{if("ControlInstruction"===e.kind){const{code:n}=bn[e.instructionKind];return Un(Dn(n),...e.parameters.map((e=>On(e))))}if("VariableInstruction"===e.kind){const{code:n}=vn[e.instructionKind];return Un(Dn(n),...e.parameters.map((e=>On(e))))}if("NumericInstruction"===e.kind){const{code:n,args:t}=Fn[e.instructionKind];return Un(Dn(n),...e.parameters.map(((e,n)=>{switch(t[n]){case"SignedInteger":return Wn(e);case"DoubleSignedInteger":return Kn(e);case"SignedFloat":return new Uint8Array(new Float32Array([e]).buffer);case"DoubleSignedFloat":return function(e){return new Uint8Array(new Float64Array([e]).buffer)}(e);default:throw new Error(`invalit argument type: ${t[n]}`)}})))}if("MemoryInstruction"===e.kind){const{code:n}=En[e.instructionKind];return Un(Dn(n),On(e.align),On(e.offset))}if("IfInstruction"===e.kind){const t=Yn(e.thenExpr),r=Yn(e.elseExpr);return Un(Dn(kn.if.code),(n=e.blockType)?"number"==typeof n?Wn(n):Zn(n):Dn(64),...t,Dn(kn.else.code),...r,Dn(kn.end.code))}var n;throw new Error(`${e.kind}`)}))}function Jn(e){return Un(...Yn(e),Dn(11))}function et(e,{enableNameSection:n}){return n?(t=function(e){return Un(zn("name"),Gn(1,Hn(e.funcs)),Gn(2,e.locals.map((({idx:e,nameMap:n})=>Un(On(e),Rn(Hn(n)))))),Gn(4,Hn(e.types)),Gn(5,Hn(e.tables)),Gn(6,Hn(e.mems)),Gn(7,Hn(e.globals)))}(e.names),Un(Dn(0),Kn(t.byteLength),t)):new Uint8Array;var t}function nt(e,n){const t=Un(Pn,qn),r=Un(t,Gn(1,e.types.map(Xn)),Gn(3,e.funcs.map((e=>On(e.type)))),Gn(4,e.tables.map((e=>Un(Dn("Funcref"===e.refType?112:111),Qn(e.limits))))),Gn(5,e.mems.map((e=>Qn(e.limits)))),Gn(6,e.globals.map((e=>{return Un(Un(Zn((n=e.type).valueType),Dn("Const"===n.mutKind?0:1)),Jn(e.expr));var n}))),Gn(7,e.exports.map((e=>Un(zn(e.name),Dn(Bn[e.exportKind]),On(e.index))))),Gn(9,e.elems.map((e=>{return n=e.elemList,Un(Dn(0),Jn(n.offsetExpr),Rn(n.indices.map((e=>On(e)))));var n}))),Gn(10,e.funcs.map((e=>{const n=Rn(e.locals.map((e=>Un(On(1),Zn(e))))),t=Jn(e.body);return Un(On(n.byteLength+t.byteLength),n,t)}))),et(e,n));return r}function tt(e,n){return{kind:"SyntacticPlaceholder",index:e,loc:n?.loc}}function rt(e,n){return{kind:"Uint32Literal",value:e,loc:n?.loc}}function it(e,n){return{kind:"Int32Literal",value:e,loc:n?.loc}}function st(e,n){return{kind:"Int64Literal",value:e,loc:n?.loc}}function ot(e,n){return{kind:"Float32Literal",value:e,loc:n?.loc}}function at(e,n){return{kind:"Float64Literal",value:e,loc:n?.loc}}function lt(e,n,t){return{kind:"Limits",min:e,max:n??null,loc:t?.loc}}function ct(e,n,t){return{kind:"Memory",limits:e,id:n??null,loc:t?.loc}}function ut(e,n,t){return{kind:"Module",body:e,id:n??null,loc:t?.loc}}function dt(e,n){return{kind:"Identifier",value:e,loc:n?.loc}}function pt(e,n){return{kind:"ValueType",valueKind:e,loc:n?.loc}}function ft(e,n){return{kind:"MutValueType",valueType:e,loc:n?.loc}}function mt(e,n,t){return{kind:"ParamType",id:n??null,valueType:e,loc:t?.loc}}function ht(e,n){return{kind:"RefType",refKind:e,loc:n?.loc}}function _t(e,n,t){return{kind:"LocalVar",id:n??null,valueType:e,loc:t?.loc}}function gt(e,n,t){return{kind:"FuncType",params:e,results:n,loc:t?.loc}}function yt(e,n,t){return{kind:"Type",funcType:e,id:n??null,loc:t?.loc}}function kt(e,n){return{kind:"FuncTypeRef",type:e,loc:n?.loc}}function bt(e,n,t,r){return{kind:"FuncSig",type:t??null,params:e,results:n,loc:r?.loc}}function vt(e,n,t){return{kind:"BlockType",type:n??null,results:e,loc:t?.loc}}function xt(e,n,t,r,i){return{kind:"IfInstruction",blockType:e,thenExpr:n,elseExpr:t,id:r??null,elseId:r??null,endId:r??null,loc:i?.loc}}function $t(e,n,t){return{kind:"ControlInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function Tt(e,n,t){return{kind:"VariableInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function wt(e,n,t){return{kind:"Int32NumericInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function Et(e,n,t){return{kind:"Int64NumericInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function Ft(e,n,t){return{kind:"Float32NumericInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function It(e,n,t){return{kind:"Float64NumericInstruction",instructionKind:e,parameters:n??[],loc:t?.loc}}function Lt(e,n,t,r){return{kind:"MemoryInstruction",instructionKind:e,offset:n??null,align:t??null,loc:r?.loc}}function Nt(e,n,t,r,i){return{kind:"Func",id:r??null,signature:e,locals:n,instructions:t,loc:i?.loc}}function Mt(e,n,t){return{kind:"TableType",refType:e,limits:n,loc:t?.loc}}function jt(e,n,t){return{kind:"Table",id:n??null,tableType:e,elemList:null,loc:t?.loc}}function Ct(e,n){return{kind:"FunctionIndexList",indices:e,loc:n?.loc}}function St(e,n,t,r){return{kind:"Global",id:t??null,expr:n,type:e,loc:r?.loc}}function At(e,n,t,r){return{kind:"Elem",elemList:e,offsetExpr:n,id:t??null,loc:r?.loc}}function Vt(e,n,t){return{kind:"Table",elemList:e,id:n??null,tableType:null,loc:t?.loc}}function Kt(e,n){return{kind:"ExportedFunc",index:e,loc:n?.loc}}function Pt(e,n){return{kind:"ExportedMemory",index:e,loc:n?.loc}}function qt(e,n){return{kind:"ExportedTable",index:e,loc:n?.loc}}function Bt(e,n){return{kind:"ExportedGlobal",index:e,loc:n?.loc}}function Dt(e,n,t){return{kind:"Export",name:e,sec:n,loc:t?.loc}}const Ot=r;function Wt(e,n){return function(e){const{typedefNodes:n,funcNodes:t,tableNodes:r,memNodes:i,globalNodes:s,exportNodes:o,elemNodes:a,refCtx:l}=function(e){const n={types:new Map,funcs:new Map,globals:new Map,elem:new Map,mems:new Map,tables:new Map,funcLocals:new Map},t=[],r=[],i=[],s=[],o=[],a=[],l=[];for(const n of e.body)switch(n.kind){case"Type":t.push(n);break;case"Func":r.push(n);break;case"Table":i.push(n);break;case"Memory":s.push(n);break;case"Export":o.push(n);break;case"Global":a.push(n);break;case"Elem":l.push(n)}return hn(t,n.types),hn(r,n.funcs),hn(i,n.tables),hn(s,n.mems),hn(a,n.globals),hn(l,n.elem),{typedefNodes:t,funcNodes:r,tableNodes:i,memNodes:s,globalNodes:a,exportNodes:o,elemNodes:l,refCtx:n}}(e);return z(n.map((e=>function(e){return R({kind:"FuncType",paramType:yn(e.funcType.params),resultType:e.funcType.results.map(gn)})}(e)))).mapValue((e=>U(z(i.map((e=>function(e){return Cn(e.limits).map((e=>({kind:"MemType",limits:e})))}(e)))),t.reduce(((e,n,t)=>e.mapValue((e=>function(e,n,t,r){const i=new Map;let s,o=t;const{signature:a}=e;if(null===a.type){const n=Ln(yn(a.params),a.results.map(gn)),r=t.types.findIndex((e=>Nn(e,n)));-1===r?(s=t.types.length,o={...t,types:[...t.types,n]}):s=r,hn([...a.params,...e.locals],i)}else{const n=_n(r.types,a.type);if(!n.ok)return G(n.value);s=n.value,hn(e.locals,i)}r.funcLocals.set(n,i);const l=o.types.slice();return z(e.instructions.map((e=>jn(e,{refCtx:{...r,locals:i},types:l})))).map((n=>({kind:"Func",type:s,locals:yn(e.locals),body:n}))).map((e=>({types:l,funcs:[...t.funcs,e]})))}(n,t,e,l)))),R({funcs:[],types:e})),z(a.map((e=>function(e,n){return Sn(e.elemList,{refCtx:n,offsetExpr:e.offsetExpr}).map((e=>({kind:"Elem",elemList:e})))}(e,l)))),z(o.map((e=>function(e,n){return"ExportedFunc"===e.sec.kind?_n(n.funcs,e.sec.index).map((n=>({kind:"Export",name:e.name,exportKind:"Func",index:n}))):"ExportedMemory"===e.sec.kind?_n(n.mems,e.sec.index).map((n=>({kind:"Export",name:e.name,exportKind:"Memory",index:n}))):"ExportedTable"===e.sec.kind?_n(n.tables,e.sec.index).map((n=>({kind:"Export",name:e.name,exportKind:"Table",index:n}))):"ExportedGlobal"===e.sec.kind?_n(n.globals,e.sec.index).map((n=>({kind:"Export",name:e.name,exportKind:"Global",index:n}))):void 0}(e,l)))),z(s.map((e=>function(e,n){return z(e.expr.map((e=>jn(e,{refCtx:n,types:[]})))).map((n=>({kind:"Global",expr:n,type:{kind:"GlobalType",mutKind:"MutValueType"===e.type.kind?"Var":"Const",valueType:"ValueType"===e.type.kind?gn(e.type):gn(e.type.valueType)}})))}(e,l)))))(((e,{funcs:n,types:t},i,s,o)=>r.reduce(((e,n)=>e.mapValue((e=>function(e,n,t){if(n.tables.length>0)return G({message:"Module can't have two or more tables."});if(e.tableType&&!e.elemList){const{tableType:t}=e;return Cn(t.limits).map((e=>({...n,tables:[...n.tables,{kind:"TableType",limits:e,refType:t.refType.refKind}]})))}if(e.elemList&&!e.tableType){const{elemList:r}=e,i={kind:"Limits",min:r.indices.length,max:r.indices.length};return Sn(r,{refCtx:t,offsetExpr:null}).map((e=>({tables:[{kind:"TableType",limits:i,refType:"Funcref"}],elems:[...n.elems,{kind:"Elem",elemList:e}]})))}return G({message:"Invalid table node"})}(n,e,l)))),R({tables:[],elems:i})).map((({tables:r,elems:i})=>({kind:"Module",names:An(l),types:t,funcs:n,tables:r,mems:e,globals:o,exports:s,elems:i})))))))}(e).map((e=>nt(e,n)))}const Ut={name:"lib/allocator",code:"\n    (module\n      (memory $__alloc_mem__ 10)\n      (global $__alloc_st__ (mut i32) i32.const 4)\n      (func $__malloc__ (param $size i32) (result i32) (local $next i32)\n\n        global.get $__alloc_st__\n        local.set $next\n\n        global.get $__alloc_st__\n        local.get $size\n        i32.add\n\n        global.set $__alloc_st__\n        local.get $next\n      )\n    )\n  "};function zt(){return Ut}const{visitEachChild:Rt}=O(["align","blockType","body","elemList","elseExpr","elseId","endId","expr","funcType","id","index","indices","instructions","limits","locals","max","min","name","offset","offsetExpr","parameters","params","refKind","refType","results","sec","signature","tableType","thenExpr","type","valueType"]);class Gt extends re{_blockComment(e){if(!this.input.slice(e).startsWith("(;"))return 0;let n=1,t=2;for(;n>0&&e+t<this.input.length;)";)"===this.input.substr(e+t,2)?(t+=2,n--):"(;"===this.input.substr(e+t,2)?(t+=2,n++):++t;return t}_lineComment(e){if(!this.input.slice(e).startsWith(";;"))return 0;let n=2;for(;e+n<this.input.length&&"\n"!==this.input[e+n];)++n;return n}leadingComment(e){let n=0;for(;;){const t=this._lineComment(e+n),r=this._blockComment(e+n+t);if(t+r===0)break;n+=t+r}return n}}function Ht(e){return n=>"NullPosition"===e._brand?null:n(e)}const Zt=e=>n=>{const t=n.pos,r=e(n);return r.ok?r:(n.back(t),r.error((e=>({...e,confirmed:!1}))))},Xt=e=>n=>{const t=e(n);return t.ok?R(t.value):R(function(e){return{_brand:"NullPosition",_nodeId:"null",loc:{pos:e.pos,end:e.pos}}}(n))},Qt=e=>n=>n.startsWith(e)?R({tokenKind:"Symbol",symbol:e,loc:n.consume(e.length)}):G({confirmed:!1,message:`'${e}' expected.`,occurence:{loc:{pos:n.pos,end:n.pos+1}}}),Yt=e=>n=>n.startsWith(e)?R({tokenKind:"Keyword",keyword:e,loc:n.consume(e.length)}):G({confirmed:!1,message:`'${e}' expected.`,occurence:{loc:{pos:n.pos,end:n.pos+1}}}),Jt=e=>n=>n.startsWith(e)&&n.match(/^($|[^a-zA-Z0-9\.\$_])/,e.length)?R({tokenKind:"Keyword",keyword:e,loc:n.consume(e.length)}):G({confirmed:!1,message:`'${e}' expected.`,occurence:{loc:{pos:n.pos,end:n.pos+1}}}),er=e=>Z(...e.map((e=>Jt(e)))),nr=e=>{const n=e.match(/^(\$[a-zA-Z0-9\!#\$%&'\*\+\-\.\/:<=>\?@\\\^_`\|\~]+)/);return n?R({tokenKind:"Identifier",name:n[1].slice(1),loc:e.consume(n[1].length)}):G({confirmed:!1,message:"Identifier expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}})},tr=e=>n=>{const t=e?n.match(/^([\+-]?\d+)/):n.match(/(^\d+)/);return t?R({tokenKind:"Int",value:parseInt(t[1],10),loc:n.consume(t[1].length)}):G({confirmed:!1,message:"Integer expected.",occurence:{loc:{pos:n.pos,end:n.pos+1}}})},rr=tr(!0),ir=tr(!1),sr=e=>{const n=e.match(/^([\+-]?\d+)/);if(!n)return G({confirmed:!1,message:"Decimal number expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}});const t=e.match(/^(\.\d*)/,n[1].length),r=n[1]+(t?t[1]:"");return R({tokenKind:"Decimal",value:parseFloat(r),loc:e.consume(r.length)})},or=e=>{const n=e.match(/^%%PLACEHOLDER_(\d+)%%/);return n?R({kind:"SyntacticPlaceholder",index:parseInt(n[1],10),loc:e.consume(n[0].length)}):G({message:"placeholder expected",confirmed:!1,occurence:{loc:{pos:e.pos,end:e.pos+1}}})},ar=e=>Z(e,or),lr=Q(nr)((e=>({kind:"Identifier",value:e.name,loc:e.loc}))),cr=e=>Ht(e)((e=>({kind:"Identifier",value:e.name,loc:e.loc}))),ur=Q(ir)((e=>({kind:"Uint32Literal",value:e.value,...ee(e)}))),dr=Q(rr)((e=>({kind:"Int32Literal",value:e.value,...ee(e)}))),pr=Q(rr)((e=>({kind:"Int64Literal",value:e.value,...ee(e)}))),fr=Q(sr)((e=>({kind:"Float32Literal",value:e.value,...ee(e)}))),mr=Q(sr)((e=>({kind:"Float64Literal",value:e.value,...ee(e)}))),hr=Z(lr,ur),_r=Q(Z(Jt("i32"),Jt("i64"),Jt("f32"),Jt("f64")))((e=>({kind:"ValueType",valueKind:e.keyword,...ee(e)}))),gr=Zt(Q(Qt("("),Jt("param"),Xt(nr),_r,Qt(")"))(((e,n,t,r,i)=>({kind:"ParamType",id:cr(t),valueType:r,...ee(e,n,t,r,i)})))),yr=Zt(Q(Qt("("),Jt("mut"),_r,Qt(")"))(((e,n,t,r)=>({kind:"MutValueType",valueType:t,...ee(e,n,t,r)})))),kr=Zt(Q(Qt("("),Jt("result"),Z(Jt("i32"),Jt("i64"),Jt("f32"),Jt("f64")),Qt(")"))(((e,n,t,r)=>({kind:"ValueType",valueKind:t.keyword,...ee(e,n,t,r)})))),br=Zt(Q(Qt("("),Jt("func"),le(gr),le(kr),Qt(")"))(((e,n,t,r,i)=>({kind:"FuncType",params:t.values,results:r.values,...ee(e,n,t,r,i)})))),vr=Zt(Q(Qt("("),Jt("type"),Xt(nr),br,Qt(")"))(((e,n,t,r,i)=>({kind:"Type",id:cr(t),funcType:r,...ee(e,n,t,r,i)})))),xr=Zt(Q(Qt("("),Jt("type"),hr,Qt(")"))(((e,n,t,r)=>({...t,...ee(e,n,t,r)})))),$r=Zt(Q(Xt(xr),le(gr),le(kr))(((e,n,t)=>({kind:"FuncSig",type:Ht(e)((e=>e)),params:n.values,results:t.values,...ee(e,n,t)})))),Tr=Zt(Q(Xt(xr),le(kr))(((e,n)=>({kind:"BlockType",type:Ht(e)((e=>e)),results:n.values,...ee(e,n)})))),wr=Zt(Q(Jt("if"),Xt(nr),Tr,le(X((()=>Vr))),Jt("else"),Xt(nr),le(X((()=>Vr))),Jt("end"),Xt(nr))(((e,n,t,r,i,s,o,a,l)=>({kind:"IfInstruction",id:cr(n),elseId:cr(s),endId:cr(l),blockType:t,thenExpr:r.values,elseExpr:o.values,...ee(e,n,t,r,i,s,o,a,l)})))),Er=Zt(Q(xr)((e=>({kind:"FuncTypeRef",type:e,loc:e.loc})))),Fr=Zt(Q(er(Object.keys(bn)),le(Z(hr,Er)))(((e,n)=>({kind:"ControlInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),Ir=Zt(Q(er(Object.keys(vn)),le(hr))(((e,n)=>({kind:"VariableInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),Lr=Zt(Q(er(Object.keys(xn)),le(dr))(((e,n)=>({kind:"Int32NumericInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),Nr=Zt(Q(er(Object.keys($n)),le(pr))(((e,n)=>({kind:"Int64NumericInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),Mr=Zt(Q(er(Object.keys(Tn)),le(fr))(((e,n)=>({kind:"Float32NumericInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),jr=Zt(Q(er(Object.keys(wn)),le(mr))(((e,n)=>({kind:"Float64NumericInstruction",instructionKind:e.keyword,parameters:n.values,...ee(e,n)})))),Cr=Zt(Q(er(Object.keys(En)),Xt(Q(Yt("offset="),ur)(((e,n)=>({...n,...ee(e,n)})))),Xt(Q(Yt("align="),ur)(((e,n)=>({...n,...ee(e,n)})))))(((e,n,t)=>({kind:"MemoryInstruction",instructionKind:e.keyword,offset:Ht(n)((e=>e)),align:Ht(t)((e=>e)),...ee(e,n,t)})))),Sr=Zt(Q(Qt("("),Jt("local"),Xt(nr),_r,Qt(")"))(((e,n,t,r,i)=>({kind:"LocalVar",id:cr(t),valueType:r,...ee(e,n,t,r,i)})))),Ar=Z(Lr,Nr,Mr,jr),Vr=ar(Z(wr,Fr,Ar,Ir,Cr)),Kr=Zt(Q(Qt("("),Jt("func"),Xt(nr),$r,le(Sr),le(Vr),Qt(")"))(((e,n,t,r,i,s,o)=>({kind:"Func",id:cr(t),signature:r,locals:i.values,instructions:s.values,...ee(e,n,t,r,i,s,o)})))),Pr=Q(ur,Xt(ur))(((e,n)=>({kind:"Limits",min:e,max:Ht(n)((e=>e)),...ee(e,n)}))),qr=Zt(Q(Qt("("),Jt("memory"),Xt(nr),Pr,Qt(")"))(((e,n,t,r,i)=>({kind:"Memory",id:cr(t),limits:r,...ee(e,n,t,r,i)})))),Br=Zt(Q(Qt("("),Jt("global"),Xt(nr),Z(_r,yr),le(Vr),Qt(")"))(((e,n,t,r,i,s)=>({kind:"Global",id:cr(t),type:r,expr:i.values,...ee(e,n,t,r,i,s)})))),Dr=Zt(Q(Qt("("),Jt("elem"),le(hr),Qt(")"))(((e,n,t,r)=>({kind:"FunctionIndexList",indices:t.values,...ee(e,n,t,r)})))),Or=Zt(Q(Jt("func"),le(hr))(((e,n)=>({kind:"FunctionIndexList",indices:n.values,...ee(e,n)})))),Wr=Zt(Q(Qt("("),Jt("table"),Xt(nr),Pr,Z(Jt("funcref"),Jt("externref")),Qt(")"))(((e,n,t,r,i,s)=>({kind:"Table",elemList:null,id:cr(t),tableType:{kind:"TableType",limits:r,refType:{kind:"RefType",refKind:"funcref"===i.keyword?"Funcref":"Externref",...ee(i)},...ee(r)},...ee(e,n,t,r,i,s)})))),Ur=Zt(Q(Qt("("),Jt("table"),Xt(nr),Jt("funcref"),Dr,Qt(")"))(((e,n,t,r,i,s)=>({kind:"Table",id:cr(t),elemList:i,tableType:null,...ee(e,n,t,r,i,s)})))),zr=Z(Wr,Ur),Rr=Zt(Q(Qt("("),Jt("elem"),Xt(nr),Qt("("),Jt("offset"),le(Vr),Qt(")"),Or,Qt(")"))(((e,n,t,r,i,s,o,a,l)=>({kind:"Elem",id:cr(t),elemList:a,offsetExpr:s.values,...ee(e,n,t,r,i,s,o,a,l)})))),Gr=Zt(Q(Qt("("),Z(Jt("func"),Jt("memory"),Jt("table"),Jt("global")),hr,Qt(")"))(((e,n,t,r)=>({kind:"func"===n.keyword?"ExportedFunc":"memory"===n.keyword?"ExportedMemory":"table"===n.keyword?"ExportedTable":"ExportedGlobal",index:t,...ee(e,n,t,r)})))),Hr=Zt(Q(Qt("("),Jt("export"),(e=>{if(!e.startsWith('"'))return G({confirmed:!1,message:"String expected.",occurence:{loc:{pos:e.pos,end:e.pos+1}}});let n=0;for(;e.hasNext(++n);)if(e.startsWith("\\",n)&&e.startsWith('"',n+1))n++;else if(e.startsWith('"',n))break;return R({tokenKind:"String",value:e.slice(n).slice(1).replace("\\\t","\t").replace("\\\n","\n").replace("\\\r","\r").replace('\\"','"').replace("\\'","'").replace("\\\\","\\"),loc:e.consume(n+1)})}),Gr,Qt(")"))(((e,n,t,r,i)=>({kind:"Export",name:t.value,sec:r,...ee(e,n,t,r,i)})))),Zr=Z(vr,Kr,zr,qr,Br,Hr,Rr),Xr=Q(Qt("("),Jt("module"),Xt(nr),le(ar(Zr)),Qt(")"))(((e,n,t,r,i)=>({kind:"Module",id:cr(t),body:r.values,...ee(e,n,t,r,i)}))),Qr=le(Vr),Yr=le(ar(Zr)),Jr=Sr,ei=Xr;function ni(e,...n){let t=e[0],r=0;const i=[];for(let s=1;s<e.length;s++)"string"==typeof n[s-1]||"number"==typeof n[s-1]?t+=`${n[s-1]}`+e[s]:(i.push(n[s-1]),t+=` %%PLACEHOLDER_${r++}%% `,t+=e[s]);return{srcString:t,nodeFn:i}}const ti=new class{_maxSize;_cacheMap=new Map;constructor(e=100){this._maxSize=e}set(e,n){if(this._cacheMap.set(e,n),this._cacheMap.size>this._maxSize){const e=this._cacheMap.keys().next();this._cacheMap.delete(e.value)}}get(e){const n=this._cacheMap.get(e);if(n)return n}has(e){return this._cacheMap.has(e)}touch(e){const n=this._cacheMap.get(e);n&&(this._cacheMap.delete(e),this._cacheMap.set(e,n))}del(e){this._cacheMap.delete(e)}clearAll(){this._cacheMap=new Map}}(1e3);function ri(e,n,t,r){const i=ti.get(e+n);if(i)return r(i);const s=t(e+n);return ti.set(n,s),r(s)}function ii(e,n){return()=>{const t=e=>{if("SyntacticPlaceholder"!==e.kind){const{_nodeId:n,loc:r,...i}=Rt(e,t);return{...i,loc:void 0}}return n[e.index]()};return e.map((e=>t(e))).flat()}}const si={instructions:function(e,...n){const{srcString:t,nodeFn:r}=ni(e,...n);return ri("instructions",t,(()=>Qr(new Gt(t)).unwrap().values),(e=>ii(e,r)))},moduleFields:function(e,...n){const{srcString:t,nodeFn:r}=ni(e,...n);return ri("moduleFields",t,(()=>Yr(new Gt(t)).unwrap().values),(e=>ii(e,r)))},localVar:function(e,...n){const{srcString:t,nodeFn:r}=ni(e,...n);return ri("localVar",t,(()=>Jr(new Gt(t)).unwrap()),(e=>function(e,n){return()=>{const t=e=>{if("SyntacticPlaceholder"!==e.kind){const{_nodeId:n,loc:r,...i}=Rt(e,t);return{...i,loc:void 0}}return n[e.index]()};return t(e)}}(e,r)))}};function oi(e,n){if(!e.parameters.length)return!1;const t=e.parameters[0];return"Identifier"===t.kind&&t.value===n}function ai(e,n){return"ControlInstruction"===e.kind&&"call"===e.instructionKind&&oi(e,n)}const li={name:"lib/float",code:'\n    (module\n      (func $__float_new__ (param $value f64) (result i32) (local $addr i32)\n        i32.const 8\n        call $__malloc__\n        local.tee $addr\n        local.get $value\n        f64.store offset=0\n        local.get $addr\n\n        ;; Note:\n        ;; We should add the following tag to LSB 4-bits of the floating-point number address.\n        ;; [0010] = 0x2\n\n        i32.const 4\n        i32.shl \n        i32.const 2\n        i32.or\n      )\n      (func $__float_get__ (param $addr i32) (result f64)\n        local.get $addr\n        i32.const 4\n        i32.shr_u\n        f64.load offset=0\n      )\n      (export "__float_get__" (func $__float_get__))\n    )\n  ',dependencies:[zt()]};function ci(){return li}const ui=si.instructions`
  call $__float_new__
`,di=si.instructions`
  call $__float_get__
`,pi=e=>e.reduce(((e,n)=>{if(!ai(n,"__float_get__"))return[...e,n];const t=e.slice(-1);return t.length&&ai(t[0],"__float_new__")?e.slice(0,e.length-1):[...e,n]}),[]),fi={name:"lib/tuple",dependencies:[zt()],code:"\n    (module\n      (func $__tuple_new__ (param $v0 i32) (param $v1 i32) (result i32) (local $addr i32)\n        i32.const 8\n        call $__malloc__\n        local.set $addr\n\n        local.get $addr\n        local.get $v0\n        i32.store offset=0\n\n        local.get $addr\n        local.get $v1\n        i32.store offset=4\n\n        local.get $addr\n      )\n      (func $__tuple_get_v0__ (param $addr i32) (result i32)\n        local.get $addr\n        i32.load offset=0\n      )\n      (func $__tuple_get_v1__ (param $addr i32) (result i32)\n        local.get $addr\n        i32.load offset=4\n      )\n    )\n  "};function mi(){return fi}const hi=si.instructions`
  call $__tuple_new__
`,_i=e=>si.instructions`
    call $__tuple_get_v${e}__
  `(),gi={name:"lib/list",dependencies:[mi()],code:'\n    (module\n      (func $__list_new__ (result i32)\n        i32.const 0\n      )\n\n      (func $__list_push__ (param $list_addr i32) (param $value i32) (result i32)\n        local.get $list_addr\n        local.get $value\n        call $__tuple_new__\n\n        ;; Note:\n        ;; We should add the following tag to LSB 4-bits of the list address.\n        ;; [0100] = 0x4\n        i32.const 4\n        i32.shl\n        i32.const 4\n        i32.or\n      )\n\n      (func $__list_is_empty__ (param $list_addr i32) (result i32)\n        local.get $list_addr\n        i32.const 0\n        i32.eq\n      )\n\n      (func $__list_head__ (param $list_addr i32) (result i32)\n        local.get $list_addr\n        i32.const 4\n        i32.shr_u\n        call $__tuple_get_v1__\n      )\n\n      (func $__list_tail__ (param $list_addr i32) (result i32)\n        local.get $list_addr\n        i32.const 4\n        i32.shr_u\n        call $__tuple_get_v0__\n      )\n\n      (export "__list_head__" (func $__list_head__))\n      (export "__list_tail__" (func $__list_tail__))\n    )\n  '};function yi(){return gi}const ki=si.instructions`
  call $__list_new__
`,bi=si.instructions`
  call $__list_push__
`,vi=(si.instructions`
  call $__list_is_empty__
`,si.instructions`
  call $__list_head__
`),xi=si.instructions`
  call $__list_tail__
`,$i={name:"lib/environment",dependencies:[mi()],code:"\n    (module\n      (func $__env_new__ (param $parent_addr i32) (param $value i32) (result i32)\n        local.get $parent_addr\n        local.get $value\n        call $__tuple_new__\n      )\n\n      (func $__env_get__ (param $addr i32) (param $idx i32) (result i32)\n        local.get $idx\n        if (result i32)\n          local.get $addr\n          i32.load\n          local.get $idx\n          i32.const 1\n          i32.sub\n          call $__env_get__\n        else\n          local.get $addr\n          call $__tuple_get_v1__\n        end\n      )\n\n      (func $__env_parent__ (param $addr i32) (result i32)\n        local.get $addr\n        call $__tuple_get_v0__\n      )\n    )\n  "};function Ti(){return $i}function wi(){return Ot.paramType(Ot.valueType("i32"),Ot.identifier("current_env_addr"))}const Ei=si.instructions`
  i32.const -1
  local.set $current_env_addr
`,Fi=si.instructions`
  call $__env_new__
`,Ii=si.instructions`
  ${Fi}
  local.set $current_env_addr
`,Li=si.instructions`
  local.get $current_env_addr
`,Ni=si.instructions`
  local.set $current_env_addr
`,Mi=si.instructions`
  local.get $current_env_addr
  call $__env_parent__
  local.set $current_env_addr
`;function ji(e){if(e.length<3)return e;const[n,t,r]=e.slice(-3);return"current_env_addr","VariableInstruction"===(i=n).kind&&"local.get"===i.instructionKind&&oi(i,"current_env_addr")&&ai(t,"__env_parent__")&&function(e,n){return"VariableInstruction"===e.kind&&"local.set"===e.instructionKind&&oi(e,"current_env_addr")}(r)?e.slice(0,e.length-3):e;var i}const Ci={name:"lib/matcher",dependencies:[Ti(),yi()],code:"\n    (module\n      (func $__matcher_is_matched_wildcard_pattern__ (param $current_env i32) (param $value i32) (result i32)\n        local.get $current_env\n      )\n\n      (func $__matcher_is_matched_empty_list_pattern__ (param $current_env i32) (param $value i32) (result i32)\n        local.get $value\n        call $__list_is_empty__\n        if (result i32)\n          local.get $current_env\n        else\n          i32.const 0\n        end\n      )\n\n      (func $__matcher_is_matched_identifier_pattern__ (param $current_env i32) (param $value i32) (result i32)\n        local.get $current_env\n        local.get $value\n        call $__env_new__\n      )\n    )\n  "},Si=si.instructions`
  call $__matcher_is_matched_wildcard_pattern__
`,Ai=si.instructions`
  call $__matcher_is_matched_empty_list_pattern__
`,Vi=si.instructions`
  call $__matcher_is_matched_identifier_pattern__
`;function Ki(e,n){return{getIndex:t=>t.name===e.name?R(0):n.getIndex(t).map((e=>e+1))}}class Pi{touched=!1;funcNodes=[];localVarNodes=[];level=0;get isInFunctionDefinition(){return this.level>0}enter(){return this.level++,this.touched||(this.touched=!0),this.funcNodes.length}leave(e){this.level--;const n=this.funcNodes.length,t=Ot.func(Ot.funcSig([wi()],[Ot.valueType("i32")]),this.localVarNodes,e,function(e){return Ot.identifier(`__fn_${e}__`)}(n));return this.funcNodes.push(t),this.localVarNodes=[],n}useLocalVar(e){e.id&&(this.localVarNodes.some((n=>n.id?.value===e.id.value))||this.localVarNodes.push(e))}buildFuncs(){return this.touched?[Ot.typedef(Ot.funcType([{...wi(),id:null}],[Ot.valueType("i32")]),Ot.identifier("__fn_type__")),...this.funcNodes.slice()]:[]}buildTables(){if(!this.touched)return[];const e=this.funcNodes.map((e=>e.id));return[Ot.tableWithElemList(Ot.functionIndexList(e),Ot.identifier("__func_table__"))]}callInstr=si.instructions`
    call_indirect $__func_table__ $__fn_type__
  `}class qi{funcNodes=[];enter(){return this.funcNodes.length}leave(e){const n=Ot.identifier(`__matcher_${this.funcNodes.length}__`),t=Ot.func(Ot.funcSig([wi(),Ot.paramType(Ot.valueType("i32"),Ot.identifier("value"))],[Ot.valueType("i32")]),[],e,n);return this.funcNodes.push(t),n}buildFuncs(){return this.funcNodes.slice()}}const Bi=(e,{withFloat:n,withList:t})=>n||t?`\n    (func $__comparator_poly_${e}__ (param $left i32) (param $right i32) (result i32) (local $tag i32)\n      local.get $left\n      i32.const 1\n      i32.and\n      if (result i32)\n        ;; $left is true or signed-integer\n        local.get $left\n        local.get $right\n        i32.${e}_s\n      else\n        ;; $left is false or empty list or address\n        local.get $left\n        if (result i32)\n          local.get $left\n          i32.const 14\n          i32.and\n          local.set $tag\n          ${n?`\n        local.get $tag\n        i32.const 2\n        i32.eq\n        if (result i32)\n          ;; $left and $right is floating-point number\n          local.get $left\n          call $__float_get__\n          local.get $right\n          call $__float_get__\n          f64.${e}\n        else\n    `:""}\n            ${t?`\n        local.get $tag\n        i32.const 4\n        i32.eq\n        if (result i32)\n          ;; $left is non-empty list\n          local.get $left\n          local.get $right\n          call $__comparator_list_${e}__\n        else\n       `:""}\n              unreachable\n            ${t?"end":""}\n          ${n?"end":""}\n        else\n          ;; $left is false or emptyList\n          local.get $left\n          local.get $right\n          i32.${e}_s\n        end\n      end\n    )\n  `:`\n      (func $__comparator_poly_${e}__ (param $left i32) (param $right i32) (result i32)\n        local.get $left\n        local.get $right\n        i32.${e}_s\n      )\n    `,Di=e=>`\n  (func $__comparator_list_${e}__ (param $l1 i32) (param $l2 i32) (result i32) (local $h1 i32) (local $h2 i32)\n    local.get $l1\n    if (result i32)\n      local.get $l2\n      if (result i32)\n        local.get $l1\n        call $__list_head__\n        local.tee $h1\n        local.get $l2\n        call $__list_head__\n        local.tee $h2\n        call $__comparator_poly_${e}__\n        if (result i32)\n          i32.const 1\n        else\n          local.get $h1\n          local.get $h2\n          call $__comparator_poly_eq__\n          if (result i32)\n            local.get $l1\n            call $__list_tail__\n            local.get $l2\n            call $__list_tail__\n            call $__comparator_list_${e}__\n          else\n            i32.const 0\n          end\n        end\n      else\n        ${"gt"===e||"ge"===e?"i32.const 1":"i32.const 0"}\n      end\n    else\n      local.get $l1\n      local.get $l2\n      ${"eq"===e?"i32.eq":"i32."+e+"_s"}\n    end\n  )\n`,Oi=({withFloat:e,withList:n})=>e||n?`\n    (func $__comparator_poly_eq__ (param $left i32) (param $right i32) (result i32) (local $tag i32)\n      local.get $left\n      i32.const 1\n      i32.and\n      if (result i32)\n        local.get $left\n        local.get $right\n        i32.eq\n      else\n        local.get $left\n        if (result i32)\n          local.get $left\n          i32.const 14\n          i32.and\n          local.set $tag\n          ${e?"\n        local.get $tag\n        i32.const 2\n        i32.eq\n        if (result i32)\n          ;; $left and $right is floating-point number\n          local.get $left\n          call $__float_get__\n          local.get $right\n          call $__float_get__\n          f64.eq\n        else\n    ":""}\n            ${n?"\n        local.get $tag\n        i32.const 4\n        i32.eq\n        if (result i32)\n          ;; $left is non-empty list\n          local.get $left\n          local.get $right\n          call $__comparator_list_eq__\n        else\n       ":""}\n              unreachable\n            ${n?"end":""}\n          ${e?"end":""}\n        else\n          local.get $left\n          local.get $right\n          i32.eq\n        end\n      end\n    )\n  `:"\n      (func $__comparator_poly_eq__ (param $left i32) (param $right i32) (result i32)\n        local.get $left\n        local.get $right\n        i32.eq\n      )\n    ",Wi=e=>si.instructions`
    call $__comparator_poly_${e}__
  `();function Ui(e){return"eq"==e||"ne"==e?[Ot.int32NumericInstr(`i32.${e}`)]:[Ot.int32NumericInstr(`i32.${e}_s`)]}const zi=e=>si.instructions`
    f64.${e}
  `();class Ri{_options;_env=function(){return{getIndex:e=>G({message:`No identifier: ${e.name}`})}}();_instructions=[];_enabledAllocator=!1;_enabledFloat=!1;_enabledList=!1;_enabledTuple=!1;_enabledEnv=!1;_enabledMatcher=!1;_enableComparator=!1;_includingComparisonOperators=[];_localsMainFn=[];_dependencies=[];funcDefStack=new Pi;matcherDefStack=new qi;constructor(e={typeValueMap:new Map}){this._options=e}getOptions(){return this._options}pushInstruction(e){Array.isArray(e)?e.forEach((e=>this._instructions.push(e))):this._instructions.push(e)}getInstructions(){return this._instructions}getDependencies(){if(this._enableComparator){const e=function({includeOperators:e,withFloat:n,withList:t}){const r=-1!==e.indexOf("eq"),i=-1!==e.indexOf("ne"),s=-1!==e.indexOf("lt"),o=-1!==e.indexOf("le"),a=-1!==e.indexOf("gt"),l=-1!==e.indexOf("ge");return{name:"lib/comparator",code:`\n      (module\n\n        ${s?Bi("lt",{withList:t,withFloat:n}):""}\n        ${s&&t?Di("lt"):""}\n\n        ${o?Bi("le",{withList:t,withFloat:n}):""}\n        ${o&&t?Di("le"):""}\n\n        ${a?Bi("gt",{withList:t,withFloat:n}):""}\n        ${a&&t?Di("gt"):""}\n\n        ${l?Bi("ge",{withList:t,withFloat:n}):""}\n        ${l&&t?Di("ge"):""}\n\n        ${t?Di("eq"):""}\n        ${r||i||t?Oi({withList:t,withFloat:n}):""}\n\n        ${i?"\n  (func $__comparator_poly_ne__ (param $left i32) (param $right i32) (result i32)\n    local.get $left\n    local.get $right\n    call $__comparator_poly_eq__\n    i32.const 1\n    i32.xor\n  )\n":""}\n      )\n    `,dependencies:[...n?[ci()]:[],...t?[yi()]:[]]}}({includeOperators:this._includingComparisonOperators,withFloat:this._enabledFloat,withList:this._enabledList});return[...this._dependencies,e]}return this._dependencies}setEnv(e){this._env=e}getEnv(){return this._env}getLocalsMainFn(){return this._localsMainFn}useLocalVar(e){if(e.id)if(this.funcDefStack.isInFunctionDefinition)this.funcDefStack.useLocalVar(e);else{if(this._localsMainFn.some((n=>n.id?.value===e.id.value)))return;this._localsMainFn.push(e)}}useAllocator(){this._enabledAllocator||(this._enabledAllocator=!0,this._dependencies.push(zt()))}useFloat(){this._enabledFloat||(this._enabledFloat=!0,this._dependencies.push(ci()))}useList(){this._enabledList||(this._enabledList=!0,this._dependencies.push(yi()))}useTuple(){this._enabledTuple||(this._enabledTuple=!0,this._dependencies.push(mi()))}useEnvironment(){this._enabledEnv||(this._enabledEnv=!0,this._dependencies.push(Ti()),this._localsMainFn.push(Ot.localVar(Ot.valueType("i32"),Ot.identifier("current_env_addr"))),this._instructions=[...Ei(),...this._instructions])}useMatcher(){this._enabledMatcher||(this._enabledMatcher=!0,this._dependencies.push(Ci))}useComparator(e){this._enableComparator=!0,this._includingComparisonOperators=[...new Set([...this._includingComparisonOperators,e])]}}const Gi=(e,n)=>({...n,body:[...n.body,...e.body]});class Hi{_name;_code;_dependencies;_link;additionalFields=[];constructor(e){this._name=e.name,this._code=e.code,this._dependencies=(e.dependencies??[]).slice(),this._link=e.link}get name(){return this._name}get code(){return this._code}get dependencies(){return this._dependencies}addDependency(e){return this._dependencies.push(e),this}addDependencies(e){return e.forEach((e=>this.addDependency(e))),this}get link(){return this._link}addField(e){return this.additionalFields.push(e),this}addFields(e){return e.forEach((e=>this.addField(e))),this}build(){const e=[],n=t=>{e.push(t),t.dependencies&&t.dependencies.forEach(n)};n(this);const t=[];for(;;){const n=e.pop();if(!n)break;t.find((e=>e.name===n.name))||t.push(n)}return t.reverse().slice().reduce(((e,n)=>{return U(e,(t=n.code,ei(new Gt(t))))(((e,t)=>R((n.link??Gi)(e,t))));var t}),R(Ot.mod([]))).map((e=>({...e,body:[...e.body,...this.additionalFields]})))}}const Zi={LessThan:"lt",LessEqualThan:"le",GreaterThan:"gt",GreaterEqualThan:"ge",Equal:"eq",NotEqual:"ne"},Xi={FAdd:"add",FSub:"sub",FMultiply:"mul",FDiv:"div"},Qi=B({wildcardPattern:()=>R(si.instructions`
        ${Li}
        local.get $value
        ${Si}
      `()),idPattern:()=>R(si.instructions`
        ${Li}
        local.get $value
        ${Vi}
      `()),emptyListPattern:()=>R(si.instructions`
        ${Li}
        local.get $value
        ${Ai}
      `()),listConsPattern:(e,n,t)=>U(t(e.head,n),t(e.tail,n))(((e,n)=>R(si.instructions`
          local.get $value
          if (result i32)
            local.get $value
            local.get $value
            ${vi}
            local.set $value
            ${()=>e}
            ${Ni}
            ${xi}
            local.set $value
            ${()=>n}
          else
            i32.const 0
          end
        `())))}),Yi=B({emptyListPattern:(e,n)=>n,wildcardPattern:(e,n)=>n,idPattern:({identifier:e},n)=>Ki(e,n),listConsPattern:({head:e,tail:n},t,r)=>r(n,r(e,t))});function Ji(e){return e.useEnvironment(),e.useTuple(),e=>si.instructions`
      ;; Note
      ;; Function closure is represented as a tuple:
      ;;   (recursive_flag, env_address, function_index_of_table_elements)
      ${Li}
      i32.const ${e}
      ${hi}

      ;; Note:
      ;; We should add the following tag to LSB 4-bits of the closure address.
      ;; [1110] = 0xd
      i32.const 4
      i32.shl
      i32.const 14
      i32.or
    `()}const es=si.instructions`
  i32.const 4
  i32.shr_u
  ${()=>_i(0)} ;; env for the closure is stored as the 1st value
`,ns=si.instructions`
  i32.const 4
  i32.shr_u
  ${()=>_i(1)} ;; function body index for the closure is stored as the 2nd value
`,ts=()=>e=>{const n=e=>{const t=Rt(e,n);return"Func"===t.kind?{...t,instructions:pi(t.instructions)}:"IfInstruction"===t.kind?{...t,thenExpr:pi(t.thenExpr),elseExpr:pi(t.elseExpr)}:t};return n(e)},rs=()=>e=>{const n=e=>{const t=Rt(e,n);if("Func"===t.kind){let e=t.instructions;for(;;){const n=ji(e);if(!(n.length<e.length))break;e=n}return{...t,instructions:e}}return t};return n(e)},is=e=>e;const ss=B({boolLiteral:({value:e})=>R([Ot.int32NumericInstr("i32.const",[Ot.int32(e?1:0)])]),emptyList:(e,n)=>(n.useList(),R(ki())),intLiteral:({value:e})=>R([Ot.int32NumericInstr("i32.const",[Ot.int32(v(e))])]),floatLiteral:({value:e},n)=>(n.useFloat(),R((e=>si.instructions`
    ${()=>Ot.float64NumericInstr("f64.const",[Ot.float64(e)])}
    call $__float_new__
  `())(e))),unaryExpression:(e,n,t)=>{if("Minus"===e.op.kind)return t(e.exp,n).map((e=>si.instructions`
        ${()=>e}
        i32.const -1
        i32.mul
        i32.const 2
        i32.add
      `()));if("FMinus"===e.op.kind)return n.useFloat(),t(e.exp,n).map((e=>si.instructions`
        ${()=>e}
        ${di}
        f64.const -1
        f64.mul
        ${ui}
      `()));throw new Error(`invalid operation kind: ${e.op.kind}`)},binaryExpression:(e,n,t)=>U(t(e.left,n),t(e.right,n))(((t,r)=>{switch(e.op.kind){case"Add":return R(si.instructions`
            ${()=>t}
            ${()=>r}
            i32.add
            i32.const 1
            i32.sub
          `());case"Sub":return R(si.instructions`
            ${()=>t}
            ${()=>r}
            i32.sub
            i32.const 1
            i32.add
          `());case"Multiply":return R(si.instructions`
            ${()=>t}
            i32.const 1
            i32.sub
            ${()=>r}
            i32.const 1
            i32.shr_s
            i32.mul
            i32.const 1
            i32.add
          `());case"Div":return R(si.instructions`
          ${()=>t}
          i32.const 1
          i32.shr_s
          
          ${()=>r}
          i32.const 1
          i32.shr_s

          i32.div_s
          i32.const 1
          i32.shl
          i32.const 1
          i32.or
        `());case"Or":return R([...t,...r,Ot.int32NumericInstr("i32.or",[])]);case"And":return R([...t,...r,Ot.int32NumericInstr("i32.and",[])]);case"LessThan":case"LessEqualThan":case"GreaterThan":case"GreaterEqualThan":case"Equal":case"NotEqual":{const{typeValueMap:i,dispatchUsingInferredType:s}=n.getOptions(),o=e.left._nodeId?i.get(e.left._nodeId):void 0,a=e.right._nodeId?i.get(e.right._nodeId):void 0,l=!!s&&("Bool"===o?.kind||"Int"===o?.kind||"Bool"===a?.kind||"Int"===a?.kind),c=!!s&&("Float"===o?.kind||"Float"===a?.kind),u=Zi[e.op.kind];return l?R([...t,...r,...Ui(u)]):c?(n.useFloat(),R([...t,...di(),...r,...di(),...zi(u)])):(n.useComparator(u),R([...t,...r,...Wi(u)]))}case"PEqual":return R([...t,...r,Ot.int32NumericInstr("i32.eq",[])]);case"PNotEqual":return R([...t,...r,Ot.int32NumericInstr("i32.ne",[])]);case"FAdd":case"FSub":case"FMultiply":case"FDiv":return n.useFloat(),R(si.instructions`
            ${()=>t}
            ${di}
            ${()=>r}
            ${di}
            f64.${Xi[e.op.kind]}
            ${ui}
          `());default:return G({message:`invalid kind: ${e.op.kind}`})}})).error((n=>({...n,occurence:e}))),listConstructor:(e,n,t)=>(n.useList(),U(t(e.head,n),t(e.tail,n))(((e,n)=>R([...n,...e,...bi()])))),ifExpression:(e,n,t)=>U(t(e.cond,n),t(e.then,n),t(e.else,n))(((e,n,t)=>R(si.instructions`
        ${()=>e}
        if (result i32)
          ${()=>n}
        else
          ${()=>t}
        end
      `()))),matchExpression:(e,n,t)=>{n.useEnvironment(),n.useMatcher(),n.useLocalVar(si.localVar`(local $value_for_matcher i32)`()),n.useLocalVar(si.localVar`(local $matched_env_addr i32)`()),n.useLocalVar(si.localVar`(local $prev_env_addr i32)`());const r=n.getEnv(),i=e=>{const s=(e,i)=>U((n.matcherDefStack.enter(),Qi(e.pattern,n).map((e=>[Ot.controlInstr("call",[n.matcherDefStack.leave(e)])]))),(()=>{const i=Yi(e.pattern,r);return n.setEnv(i),t(e.exp,n).tap((()=>n.setEnv(r)))})())(((e,n)=>R(si.instructions`
            ${Li}
            local.get $value_for_matcher
            ${()=>e}
            local.tee $matched_env_addr
            if (result i32)
              ${Li}
              local.set $prev_env_addr
              local.get $matched_env_addr
              ${Ni}
              ${()=>n}
              local.get $prev_env_addr
              ${Ni}
            else
              ${()=>i}
            end
          `())));return"PatternMatchClause"===e.kind?s(e,si.instructions`
          unreachable
        `()):i(e.or).mapValue((n=>s(e.patternMatch,n)))};return U(t(e.exp,n),i(e.matchClause))(((e,n)=>R(si.instructions`
          ${()=>e}
          local.set $value_for_matcher
          ${()=>n}
        `())))},identifier:(e,n)=>(n.useEnvironment(),n.getEnv().getIndex(e).map((e=>(e=>si.instructions`
    local.get $current_env_addr
    i32.const ${e}
    call $__env_get__
  `())(e))).error((n=>({...n,occurence:e})))),functionDefinition:(e,n,t)=>{n.funcDefStack.enter();const r=n.getEnv(),i=Ki({kind:"Identifier",name:"__anonymous__"},r),s=Ki(e.param,i);return n.setEnv(s),t(e.body,n).map((e=>Ji(n)(n.funcDefStack.leave(e)))).tap((()=>n.setEnv(r)))},functionApplication:(e,n,t)=>(n.useEnvironment(),n.useLocalVar(si.localVar`(local $closure_addr i32)`()),n.useLocalVar(si.localVar`(local $prev_closure_addr i32)`()),U(t(e.argument,n),t(e.callee,n))(((e,t)=>R(si.instructions`
        local.get $closure_addr
        local.set $prev_closure_addr
        ${()=>t}
        local.tee $closure_addr
        ${es}

        ;; Note
        ;; bind the closure's own address for recursive call
        local.get $closure_addr
        ${Fi}

        ${()=>e}
        ${Fi}

        local.get $closure_addr
        ${ns}
        ${n.funcDefStack.callInstr}
        local.get $prev_closure_addr
        local.set $closure_addr
      `())))),letExpression:(e,n,t)=>{n.useEnvironment();const r=n.getEnv();return z([t(e.binding,n),(()=>{const i=Ki(e.identifier,r);return n.setEnv(i),t(e.exp,n).tap((()=>n.setEnv(r))).map((e=>[...Ii(),...e]))})()]).map((e=>[...Li(),...e.flat(),...Mi()]))},letRecExpression:(e,n,t)=>{n.useEnvironment(),n.funcDefStack.enter();const r=n.getEnv(),i=Ki(e.identifier,r);return n.setEnv(i),z([(()=>{const r=Ki(e.binding.param,i);return n.setEnv(r),t(e.binding.body,n).map((e=>Ji(n)(n.funcDefStack.leave(e)))).tap((()=>n.setEnv(i)))})(),(n.setEnv(i),t(e.exp,n).map((e=>[...Ii(),...e])))]).map((e=>[...Li(),...e.flat(),...Mi()])).tap((()=>n.setEnv(r)))}});class os{buffer=[];level=0;append(e){const n=this.buffer.pop();return n?(n.endsWith("(")||!n.trim().length?this.buffer.push(n+e):this.buffer.push(n+" "+e),this):(this.pushLine(e),this)}lp(){const e=this.buffer.pop();return e?(e.trim().length?this.buffer.push(e+" ("):this.buffer.push(e+"("),this):(this.pushLine("("),this)}keywordToken(e){return this.append(e)}memArg(e,n){return this.append(`${e}${n}`)}rp(){const e=this.buffer.pop();return e?(this.buffer.push(e+")"),this):(this.pushLine(")"),this)}pushLine(e=""){return this.buffer.push("".padStart(2*this.level," ")+e.trim()),this}dump(){return this.buffer.join("\n")}indent(){this.level+=1}unindent(){this.level-=1}}function as(e,n){n.append(`${e.value}`)}function ls(e,n){e&&n.append("$"+e.value)}function cs(e,n){n.append(e.valueKind)}function us(e,n){n.lp().keywordToken("param"),ls(e.id,n),cs(e.valueType,n),n.rp()}function ds(e,n){n.lp().keywordToken("result"),cs(e,n),n.rp()}function ps(e,n){"Identifier"===e.kind?ls(e,n):as(e,n)}function fs(e,n){n.indent(),e.forEach((e=>{switch(n.pushLine(),e.kind){case"IfInstruction":return function(e,n){n.keywordToken("if"),function(e,n){e.type&&(n.lp().keywordToken("type"),ps(e.type,n),n.rp()),e.results.forEach((e=>ds(e,n)))}(e.blockType,n),fs(e.thenExpr,n),n.pushLine().keywordToken("else"),fs(e.elseExpr,n),n.pushLine().keywordToken("end")}(e,n);case"Int32NumericInstruction":case"Int64NumericInstruction":case"Float32NumericInstruction":case"Float64NumericInstruction":return function(e,n){n.keywordToken(e.instructionKind),e.parameters.forEach((e=>as(e,n)))}(e,n);case"ControlInstruction":return function(e,n){n.keywordToken(e.instructionKind),e.parameters.forEach((e=>{"FuncTypeRef"===e.kind?function(e,n){n.lp().keywordToken("type"),ps(e.type,n),n.rp()}(e,n):ps(e,n)}))}(e,n);case"MemoryInstruction":return function(e,n){n.keywordToken(e.instructionKind),e.offset&&n.memArg("offset=",e.offset.value),e.align&&n.memArg("align=",e.align.value)}(e,n);case"VariableInstruction":return function(e,n){n.keywordToken(e.instructionKind),e.parameters.forEach((e=>ps(e,n)))}(e,n)}})),n.unindent()}function ms(e,n){as(e.min,n),e.max&&as(e.max,n)}function hs(e,n){switch(e.kind){case"Type":return function(e,n){n.pushLine().lp().keywordToken("type"),ls(e.id,n),function(e,n){n.lp().keywordToken("func"),e.params.forEach((e=>us(e,n))),e.results.forEach((e=>ds(e,n))),n.rp()}(e.funcType,n),n.rp()}(e,n);case"Func":return function(e,n){n.pushLine().lp().keywordToken("func"),ls(e.id,n),function(e,n){e.type&&(n.lp().keywordToken("type"),ps(e.type,n),n.rp()),e.params.forEach((e=>us(e,n))),e.results.forEach((e=>ds(e,n)))}(e.signature,n),e.locals.forEach((e=>function(e,n){n.lp().keywordToken("local"),ls(e.id,n),cs(e.valueType,n),n.rp()}(e,n))),fs(e.instructions,n),n.rp()}(e,n);case"Table":return function(e,n){n.pushLine().lp().keywordToken("table"),ls(e.id,n),e.tableType&&function(e,n){ms(e.limits,n),function(e,n){"Funcref"===e.refKind?n.keywordToken("funcref"):n.keywordToken("externref")}(e.refType,n)}(e.tableType,n),e.elemList&&(n.keywordToken("funcref"),function(e,n){n.lp().keywordToken("elem"),e.indices.forEach((e=>ps(e,n))),n.rp()}(e.elemList,n)),n.rp()}(e,n);case"Memory":return function(e,n){n.pushLine().lp().keywordToken("memory"),ls(e.id,n),ms(e.limits,n),n.rp()}(e,n);case"Global":return function(e,n){n.pushLine().lp().keywordToken("global"),ls(e.id,n),function(e,n){"MutValueType"===e.kind?(n.lp().keywordToken("mut"),cs(e.valueType,n),n.rp()):cs(e,n)}(e.type,n),fs(e.expr,n),n.rp()}(e,n);case"Export":return function(e,n){n.pushLine().lp().keywordToken("export"),function(e,n){const t=e.replace(/"/g,'\\"').replace(/\t/g,"\\\t").replace(/\n/g,"\\\n").replace(/\r/g,"\\\r").replace(/\\/g,"\\\\");n.append(`"${t}"`)}(e.name,n),function(e,n){switch(e.kind){case"ExportedFunc":n.lp().keywordToken("func");break;case"ExportedGlobal":n.lp().keywordToken("global");break;case"ExportedMemory":n.lp().keywordToken("memory");break;case"ExportedTable":n.lp().keywordToken("table");break;default:throw new Error(`invalid kind: ${e.kind}`)}ps(e.index,n),n.rp()}(e.sec,n),n.rp()}(e,n);case"Elem":return function(e,n){n.pushLine().lp().keywordToken("elem"),ls(e.id,n),n.indent(),n.pushLine().lp().keywordToken("offset"),fs(e.offsetExpr,n),n.rp(),n.pushLine(),function(e,n){n.keywordToken("func"),e.indices.forEach((e=>ps(e,n)))}(e.elemList,n),n.unindent(),n.rp()}(e,n);default:throw new Error(`unknow kind: ${e.kind}`)}}function _s(e){const n=new os;return function(e,n){n.pushLine().lp().keywordToken("module"),n.indent(),e.body.forEach((e=>hs(e,n))),n.unindent(),n.rp()}(e,n),n.dump()}function gs(e,n){if("Int"===n.kind)return e=>({...n,value:x(0,e)});if("Float"===n.kind)return t=>({...n,value:$(e,t)});if("Bool"===n.kind)return e=>({...n,value:T(0,e)});if("List"===n.kind){const t=gs(e,n.elementType);return r=>({...n,value:w(e,r).map(t)})}if("TypeParameter"===n.kind)return()=>({...n,value:"unknown"});if("Function"===n.kind)return e=>({...n,value:`Closure@${F(e,4)}`});throw new Error(`${n.kind}`)}const ys=function(e={}){const n=e.remapWithSubstitutions&&I(e.remapWithSubstitutions.map((e=>e.from))),t=n&&n.reduce(((e,n)=>(e[n.id]=!0,e)),[]),r={idMap(e){return t?(t[e]=void 0,e-t.slice(this.baseId,e).reduce(((e,n)=>n?e+1:e),0)-this.baseId):e-this.baseId},baseId:0};return e=>{const n=q(e);return P(e,{...r,baseId:n})}}(),{forEachChild:ks,visitEachChild:bs}=O(["argument","binding","body","callee","cond","else","exp","head","identifier","left","matchClause","or","param","pattern","patternMatch","right","tail","then"]);function vs({code$:e,settingsService:n}){const t=new m.x,r=new m.x,i=e.asObservable().pipe((0,f.b)(100),(0,_.U)(Ce),(0,g.B)()),s=new m.x,o=(0,h.a)(s,e,i).pipe((0,f.b)(50),(0,_.U)((([e,n,t])=>t.map((t=>{const r=Se(n,e.start),i=Se(n,e.end);let s=null;const o=[],a=e=>{(e.loc?.pos??Number.MAX_SAFE_INTEGER)<=r&&i<=(e.loc?.end??-1)&&(s=e,o.push(e._nodeId)),ks(e,a)};return a(t),{path:o,found:s}})))),(0,g.B)()),a=i.pipe((0,_.U)((e=>e.error((e=>({...e,messageWithTypes:void 0}))).mapValue(mn))),(0,g.B)()),l=a.pipe((0,_.U)((e=>e.map((e=>e.typeValueMap))))),c=a.pipe((0,_.U)((e=>e.map((e=>e.rootPrimaryType.expressionType))))),u=(0,h.a)(i,l).pipe((0,_.U)((([e,n])=>{return t=n,e.map((e=>{if(!t.ok)return e;const n=t.value,r=e=>{const t=bs(e,r);if(!e._nodeId)return t;const i=n.get(e._nodeId);return i?{typeInfo:ys(i),...t}:t};return r(e)}));var t})),(0,g.B)()),d=(0,h.a)(i,l,n.settings$).pipe((0,_.U)((([e,n,{dispatchUsingInferredType:t,reduceInstructions:r}])=>U(e,n)(((e,n)=>function(e,n={dispatchUsingInferredType:!1,reduceInstructions:!1,typeValueMap:new Map}){const t=new Ri(n);return ss(e,t).mapValue((e=>{const r=Ot.func(Ot.funcSig([],[Ot.valueType("i32")]),t.getLocalsMainFn(),[...t.getInstructions(),...e],Ot.identifier("main")),i=Ot.exportNode("main",Ot.exportedFunc(Ot.identifier("main")));return new Hi({name:"compiled",code:"(module)"}).addDependencies(t.getDependencies()).addFields(t.matcherDefStack.buildFuncs()).addFields(t.funcDefStack.buildFuncs()).addField(r).addFields(t.funcDefStack.buildTables()).addField(i).build().map(function(e){return e.reduceInstructions?function(...e){return e.reduce(((e,n)=>{const t=n();return n=>t(e(n))}),is)}(ts,rs):is}(n)).error((e=>({...e,occurence:void 0})))}))}(e,{typeValueMap:n,dispatchUsingInferredType:t,reduceInstructions:r}))))),(0,g.B)()),p=d.pipe((0,_.U)((e=>e.map(_s))),(0,g.B)()),v=(0,h.a)([d,n.settings$]).pipe((0,_.U)((([e,{enableNameSection:n}])=>e.mapValue((e=>Wt(e,{enableNameSection:n})))))),x=(0,h.a)(e,c).pipe((0,_.U)((([e,n])=>{if(n.ok)return[];{const{line:t,character:r}=function(e,n){let t=0,r=0;for(let i=0;i<e.length&&i<n;i++)"\n"===e[i]?(r=0,t++):r++;return{line:t,character:r}}(e,n.value.occurence.loc.pos);return[{type:"error",text:n.value.messageWithTypes?n.value.messageWithTypes(ys):n.value.message,row:t,column:r}]}})),(0,g.B)()),$=r.pipe((0,y.M)((0,h.a)(c,v)),(0,k.w)((async([e,[n,t]])=>{if(e)return{shouldClear:!0};if(!n.ok)return{type:"error",message:n.value.message};if(!t.ok)return{type:"error",message:t.value.message};try{const{instance:e}=await WebAssembly.instantiate(t.value);return{type:"success",value:gs(e,n.value)(e.exports.main())}}catch(e){if(!(e instanceof Error))throw e;return{type:"error",message:e.message||"unknown error"}}})),(0,b.R)(((e,n)=>n.shouldClear?[]:[...e,n]),[]));return{initialContent:e.getValue(),rawCode$:t,code$:e,execute$:r,selection$:s,selectedAstNode$:o,parseResult$:i,typeValueMap$:l,ast$:u,primaryType$:c,diagnostics$:x,wat$:p,wasm$:v,evaluatedResult$:$}}const xs={enableNameSection:!0,dispatchUsingInferredType:!0,reduceInstructions:!0},$s=(0,c.createContext)(null),Ts=$s.Provider,ws=(0,c.createContext)(null),Es=ws.Provider;function Fs({code$:e,children:n}){const t=function(){const e=new d.X(xs);return{patch:n=>{const t=e.getValue();e.next({...t,...n})},settings$:e.asObservable()}}(),r=vs({code$:e,settingsService:t});return(0,i.jsx)(Ts,{value:t,children:(0,i.jsx)(Es,{value:r,children:n})})}const Is=ws,Ls=$s;var Ns=t(2779),Ms=t.n(Ns);const js={root:"F1BrBmXU4S6t6tFJPcfE",main:"w4Wr1PwcPy0FcjjZGwKX",heading:"B2U8_JeLNregbPEDu7Oa",buttonWrap:"rn4vaFxSkhEmhdy3ovaw",open:"pmLjgZorEkJLfobaLC0n",textButton:"FcSpHko2EOfn6grhLED2",panel:"_NzKOHepSAyWfJiBRMo_",left:"l4EaBsurZE3aN7fAAvF7",right:"yAPYNsrC2tHXgP7tbMVh",settingItem:"m3w8MqCrydWxJM6HtcFF",exampleItem:"MLPl3eABaKFCcqEKh1aL"};var Cs=t(9054);function Ss(e){const n=(0,c.useContext)(Ls),[t,r]=(0,c.useState)(xs[e]);return(0,c.useEffect)((()=>n.settings$.pipe((0,b.R)(((e,n)=>({prev:e.current,current:n})),{current:xs,prev:null}),(0,Cs.h)((n=>!n.prev||n.prev[e]!==n.current[e]))).subscribe((({current:n})=>r(n[e]))).unsubscribe),[]),[t,(0,c.useCallback)((t=>n.patch({[e]:t})),[n])]}const As=[{name:"Integer arimetic expression",code:"\n(2 + 6) * 4 / 5\n    "},{name:"Floating number arithmetic expression",code:"\n2.0 *. 1.6 +. 3.3\n    "},{name:"If expression",code:"\n1 = 2 then true else false\n    "},{name:"Let expression",code:"\nlet a = 1 in\nlet b = 2 in\nlet a = 4 in\n\na * b + a\n    "},{name:"Function application",code:"\nlet add = fun a -> fun b -> a + b in\nadd 10 20\n    "},{name:"Recursive function",code:"\nlet rec fact = fun n ->\n  if n < 2 then 1 else n * fact(n - 1) in\nfact 10\n    "},{name:"List and pattern matching",code:"\nlet rec range = fun s -> fun e ->\n  if s > e - 1 then [] else s::range (s + 1) e in\n\nlet rec map = fun f -> fun l ->\n  match l with [] -> [] | x::y -> (f x)::(map f y) in\n\nlet l1 = range 0 10 in\nlet twice = fun x -> x * 2 in\nmap twice l1\n    "}];function Vs({className:e}){const n=(0,c.useContext)(Is),[t,r]=Ss("dispatchUsingInferredType"),[s,o]=Ss("reduceInstructions"),[a,l]=Ss("enableNameSection"),[u,d]=(0,c.useState)(!1),[p,f]=(0,c.useState)(!1),m=(0,c.useCallback)((()=>d(!1)),[]),h=(0,c.useCallback)((()=>f(!1)),[]),_=e=>n=>{n?document.addEventListener("click",e,{once:!0}):document.removeEventListener("click",e)};return(0,i.jsxs)("header",{className:Ms()(e,js.root),children:[(0,i.jsxs)("div",{className:js.main,children:[(0,i.jsx)("h1",{className:js.heading,children:"PicoML Playground"}),(0,i.jsxs)("div",{className:Ms()(js.buttonWrap,{[js.open]:p}),onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{className:js.textButton,onClick:()=>f(!p),children:"Examples"}),p&&(0,i.jsx)("div",{className:Ms()(js.panel,js.left),ref:_(h),children:(0,i.jsx)("ul",{className:js.exampleList,children:As.map((({name:e,code:t})=>(0,i.jsx)("li",{className:js.exampleItem,children:(0,i.jsx)("button",{onClick:()=>{n.rawCode$.next(t.trim()),h()},children:e})},e)))})})]})]}),(0,i.jsx)("div",{className:js.subActions,children:(0,i.jsxs)("div",{className:Ms()(js.buttonWrap,{[js.open]:u}),onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{className:js.textButton,onClick:()=>d(!u),children:"Settings"}),u&&(0,i.jsxs)("div",{className:Ms()(js.panel,js.right),ref:_(m),children:[(0,i.jsxs)("div",{className:js.settingItem,children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:t,onChange:()=>r(!t)}),(0,i.jsx)("span",{children:"Static Dispatch"})]}),(0,i.jsx)("p",{children:"If enabled, compilation of some polymorphic operations will be optimized using inferred type statically."})]}),(0,i.jsxs)("div",{className:js.settingItem,children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:s,onChange:()=>o(!s)}),(0,i.jsx)("span",{children:"Reduce Instructions"})]}),(0,i.jsx)("p",{children:"If enabled, redundant WASM instructions(e.g. unneeded get/set floating-point values) will be removed."})]}),(0,i.jsxs)("div",{className:js.settingItem,children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:a,onChange:()=>l(!a)}),(0,i.jsx)("span",{children:"Emit WASM name section"})]}),(0,i.jsx)("p",{children:"If enabled, the names of functions or variables are reflected to Chrome devtool. "})]})]})]})})]})}const Ks="n2h_uHww_4tvrzBXFd1T",Ps="VfRaNUTN9QF7JN9GTNM2",qs="oYSLqQw_LlXUJya42VAF";function Bs({children:e,sectionName:n}){return(0,i.jsxs)("section",{className:Ps,children:[n&&(0,i.jsx)("h2",{className:qs,children:n}),(0,i.jsx)("div",{className:Ks,children:e})]})}var Ds=t(124);const Os="OlCcfPyTS4R0y38IHHLm";function Ws(){const e=(0,c.useRef)(null),n=(0,c.useContext)(Is);return(0,c.useEffect)((()=>{if(e.current)return function(e,n){if(!e)return;const t=a().edit(e,{mode:"ace/mode/ocaml"});t.commands.addCommand({name:"executeWasm",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:()=>n.execute$.next(null)}),t.setTheme("ace/theme/iceberg");const r=t.getSession();r.setTabSize(2),r.setValue(n.initialContent),t.on("change",(()=>n.code$.next(r.getValue())));const i=new Ds.w0;return i.add(n.rawCode$.subscribe((e=>r.setValue(e)))),i.add(n.diagnostics$.subscribe((e=>r.setAnnotations([...e])))),r.selection.on("changeSelection",(()=>{const e=r.selection.getRange();n.selection$.next({start:{line:e.start.row,character:e.start.column},end:{line:e.end.row,character:e.end.column}})})),()=>{t.destroy(),i.unsubscribe()}}(e.current,n)}),[e.current,n]),(0,i.jsx)("div",{className:Ms()(Os),ref:e})}var Us=t(8476),zs=t.n(Us);t(3129);const Rs="FWAw_oPHiuoTBOeda2RA";function Gs(){const[e,n]=(0,c.useState)({__html:""}),[t,r]=(0,c.useState)(!1),s=(0,c.useContext)(Is);return(0,c.useEffect)((()=>{const e=s.wat$.subscribe((e=>{if(e.ok){r(!1);const t=zs().highlight(e.value,zs().languages.wasm,"wasm");n({__html:t})}else console.error(e.value.message),r(!0)}));return()=>e.unsubscribe()}),[]),t?(0,i.jsx)("div",{children:"Error"}):(0,i.jsx)("div",{className:Ms()(Rs),children:(0,i.jsx)("pre",{className:"language-wasm",children:(0,i.jsx)("code",{className:"language-wasm",dangerouslySetInnerHTML:e})})})}const Hs="crbSjFb9Yvhhv5TOlyNR";var Zs=t(8047),Xs=t.n(Zs);function Qs(e){return(0,i.jsx)(Xs(),{...e,theme:{base00:"#161821",base01:"#1e2132",base02:"#45493e",base03:"#6b7089",base04:"#6b7089",base05:"#c6c8d1",base06:"#c6c8d1",base07:"#c6c8d1",base08:"#ceb0b6",base09:"#89b8c2",base0A:"#84a0c6",base0B:"#89b8c2",base0C:"#89b8c2",base0D:"#84a0c6",base0E:"#84a0c6",base0F:"#686f9a"}})}function Ys(e,n){const t=(0,c.useContext)(Is),[r,i]=(0,c.useState)(n?R(n):null);return(0,c.useEffect)((()=>{const n=t[e];if("object"!=typeof(r=n)||!r.subscribe)throw new Error(`${e} is not Observable`);var r;const s=n.subscribe((e=>{(function(e){return"object"==typeof e&&"boolean"==typeof e.ok})(e)&&i(e)}));return()=>s.unsubscribe()}),[]),r?r.ok?{ready:!0,data:r.value,error:null}:{ready:!0,data:null,error:r.value}:{ready:!1,data:null,error:null}}function Js(){const e=Ys("ast$"),n=Ys("selectedAstNode$");return e.ready?e.error?(0,i.jsx)("div",{children:"Error"}):(0,i.jsx)("div",{className:Ms()(Hs),children:(0,i.jsx)(Qs,{src:e.data,shouldCollapse:e=>{const{_nodeId:t}=e.src;return n.data&&n.data.found?!n.data.path.includes(t):e.namespace.length>=3},enableClipboard:!1})}):null}const eo={table:"TE8wMQ5O67ymI80JlLt4",addressCell:"BYZEHkXjOMXrqfLsSDgY",cell:"zYC4OOEZiAgSBHqsQl98",asciiCell:"e9b6YcFTYh9Rbp0CFvg9"};function no(e){return e<32||e>=127?".":String.fromCharCode(e)}function to(){const e=Ys("wasm$",new Uint8Array);if(!e.ready)return null;if(e.error)return(0,i.jsx)("div",{children:"Error"});const n=function(e){const n=[];let t;for(let r=0;r<e.byteLength;r+=2)r%16==0&&(t={address:F(r,8),values:[],ascii:""},n.push(t)),t.ascii+=no(e[r]),r+1<e.byteLength?(t.ascii+=no(e[r+1]),t.values.push(F(e[r],2)+F(e[r+1],2))):t.values.push(F(e[r],2));if(n.length){const e=n[n.length-1];e.values=[...e.values,...[...new Array(8-e.values.length)].map((()=>""))]}return n}(e.data);return(0,i.jsx)("div",{className:Ms()(eo.root),children:(0,i.jsx)("table",{className:Ms()(eo.table),children:(0,i.jsx)("tbody",{children:n.map((e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:eo.addressCell,children:e.address}),e.values.map(((e,n)=>(0,i.jsx)("td",{className:eo.cell,children:e},n))),(0,i.jsx)("td",{className:eo.asciiCell,children:e.ascii})]},e.address)))})})})}const ro={root:"yinsCRX1oDFgc0zDvf7A",buttonsArea:"PzUGSNHncBcNdMFoxYBv",logList:"iKLshnGX4dg1p92qaTXQ",logItem:"mH9Hj36AR2hlNe5KHlWI",logHeader:"UEdU8m6lg8ZV15IssqkE",logBody:"FRqnb2gRbeAeakpz561L",error:"EPufeAn928NLD4LGkf5Z",boolNode:"HG3AhvWN82X1G8OmU24v",intNode:"hVpgsPCd1QumoKQVGcfQ",commaToken:"PNSrEKcvlB9Ozgrh6Lmq",functionNode:"PENOnhTnxfY1NHEuM61_"},io=(0,c.forwardRef)((function({label:e,children:n,className:t,...r},s){return(0,i.jsx)("button",{...r,className:Ms()(t,"_36Q16wOrgeDehhlfioR"),"aria-label":e,ref:s,children:n})})),so={icon:"TpySZsn9uOSA7EK3xdMh"};function oo(){return(0,i.jsxs)("svg",{className:so.icon,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",children:[(0,i.jsx)("path",{fill:"none",d:"M0 0h24v24H0z"}),(0,i.jsx)("path",{d:"M8 5v14l11-7z"})]})}function ao(){return(0,i.jsxs)("svg",{className:so.icon,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",children:[(0,i.jsx)("path",{fill:"none",d:"M0 0h24v24H0z"}),(0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31A7.902 7.902 0 0112 20zm6.31-3.1L7.1 5.69A7.902 7.902 0 0112 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"})]})}const lo=new Intl.NumberFormat(void 0,{useGrouping:!1,minimumFractionDigits:1});function co({node:e}){return"Int"===e.kind?(0,i.jsx)("span",{className:ro.intNode,children:`${e.value}`}):"Float"===e.kind?(0,i.jsx)("span",{className:ro.intNode,children:`${lo.format(e.value)}`}):"Bool"===e.kind?(0,i.jsx)("span",{className:ro.boolNode,children:`${e.value}`}):"List"===e.kind?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:ro.lpToken,children:"["}),e.value.map(((n,t)=>(0,i.jsxs)(c.Fragment,{children:[c.createElement(co,{node:n}),t!==e.value.length-1?(0,i.jsx)("span",{className:ro.commaToken,children:", "}):null]},t))),(0,i.jsx)("span",{className:ro.rpToken,children:"]"})]}):"Function"===e.kind?(0,i.jsx)("span",{className:ro.functionNode,children:`${e.value}`}):null}function uo(){const e=(0,c.useRef)(null),[n,t]=(0,c.useState)([]),r=(0,c.useContext)(Is);return(0,c.useEffect)((()=>r.evaluatedResult$.subscribe((n=>{t(n),e.current?.scrollIntoView()})).unsubscribe),[]),(0,i.jsxs)("div",{className:ro.root,children:[(0,i.jsxs)("div",{className:ro.buttonsArea,children:[(0,i.jsx)(io,{label:"Evaluate expression",title:"Evaluate expression",onClick:()=>r.execute$.next(null),children:(0,i.jsx)(oo,{})}),(0,i.jsx)(io,{label:"Clear logs",title:"Clear logs",onClick:()=>r.execute$.next(!0),children:(0,i.jsx)(ao,{})})]}),(0,i.jsx)("ul",{className:ro.logList,children:n.map(((e,n)=>(0,i.jsxs)("li",{className:ro.logItem,children:[(0,i.jsxs)("span",{className:ro.logHeader,children:["result#",n+1]}),(0,i.jsx)("span",{className:Ms()(ro.logBody,{[ro.error]:"error"===e.type}),children:"error"===e.type?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:"Error: "}),(0,i.jsx)("span",{children:e.message})]}):(0,i.jsx)(co,{node:e.value})})]},n)))}),(0,i.jsx)("span",{ref:e})]})}const po="tc58upt6b531KiqibZyI";function fo(e){return(0,i.jsx)(l.Z,{...e})}const mo=document.getElementById("app");(0,s.render)((0,i.jsx)((function(){const e=function(e){const n=(0,c.useRef)(new d.X(function(e){if(location.hash.startsWith("#code=")){const e=location.hash.slice(6);return(0,u.decompressFromEncodedURIComponent)(e)}return e.trim()}(e)));return(0,c.useEffect)((()=>n.current.pipe((0,p.T)(1),(0,f.b)(100)).subscribe((e=>function(e){const n=new URL(location.href);n.hash=e,location.replace(n.toString())}(`code=${(0,u.compressToEncodedURIComponent)(e)}`))).unsubscribe),[n.current]),n.current}("\n(*                                                                  *)\n(*                 Welcome to PicoML Playground!                    *)\n(*                                                                  *)\n(* Type the folloing to compile and execute the ML expression:      *)\n(* - win: Ctrl + Enter                                              *)\n(* - mac: Command + Enter                                           *)\n\nif true then 1 + 2 * 3 else 0\n");return(0,i.jsxs)(Fs,{code$:e,children:[(0,i.jsx)(Vs,{className:"cE9E63s8CJjl5jbpqkIt"}),(0,i.jsx)("main",{className:"ocblcZNTyPdoayQrBDps",children:(0,i.jsxs)(fo,{resizerClassName:po,split:"vertical",defaultSize:"43%",children:[(0,i.jsxs)(fo,{resizerClassName:po,split:"horizontal",defaultSize:"65%",children:[(0,i.jsx)(Bs,{children:(0,i.jsx)(Ws,{})}),(0,i.jsx)(Bs,{sectionName:"Evaluation Log",children:(0,i.jsx)(uo,{})})]}),(0,i.jsxs)(fo,{resizerClassName:po,split:"horizontal",defaultSize:"45%",children:[(0,i.jsx)(Bs,{sectionName:"Expression AST",children:(0,i.jsx)(Js,{})}),(0,i.jsxs)(fo,{resizerClassName:po,split:"horizontal",defaultSize:"63%",children:[(0,i.jsx)(Bs,{sectionName:"Compiled WAT",children:(0,i.jsx)(Gs,{})}),(0,i.jsx)(Bs,{sectionName:"Compiled WASM",children:(0,i.jsx)(to,{})})]})]})]})}),(0,i.jsxs)("footer",{className:"aWnMsFHT9k1yQn3uZhA7",children:["Powered by ",(0,i.jsx)("a",{href:"https://github.com/Quramy/pico-ml",children:"https://github.com/Quramy/pico-ml"})]})]})}),{}),mo)}},t={};function r(e){var i=t[e];if(void 0!==i)return i.exports;var s=t[e]={id:e,loaded:!1,exports:{}};return n[e].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.m=n,r.amdD=function(){throw new Error("define cannot be used indirect")},e=[],r.O=(n,t,i,s)=>{if(!t){var o=1/0;for(u=0;u<e.length;u++){for(var[t,i,s]=e[u],a=!0,l=0;l<t.length;l++)(!1&s||o>=s)&&Object.keys(r.O).every((e=>r.O[e](t[l])))?t.splice(l--,1):(a=!1,s<o&&(o=s));if(a){e.splice(u--,1);var c=i();void 0!==c&&(n=c)}}return n}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[t,i,s]},r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var n=r.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var i=t.length-1;i>-1&&!e;)e=t[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={179:0};r.O.j=n=>0===e[n];var n=(n,t)=>{var i,s,[o,a,l]=t,c=0;if(o.some((n=>0!==e[n]))){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)var u=l(r)}for(n&&n(t);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(u)},t=self.webpackChunk_pico_ml_playground=self.webpackChunk_pico_ml_playground||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var i=r.O(void 0,[792],(()=>r(1485)));i=r.O(i)})();